

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Program Listing for File BasicEventSelection.cxx &mdash; xAODAnaHelpers 9618850 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/collapsible-lists/js/CollapsibleLists.compressed.js"></script>
        <script src="../_static/collapsible-lists/js/apply-collapsible-lists.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/collapsible-lists/css/tree_view.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> xAODAnaHelpers
          

          
          </a>

          
            
            
              <div class="version">
                9618850
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../Intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Installing.html">Installing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../UsingUs.html">xAH_run.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Algorithms.html">Algorithms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Development.html">Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Community.html">Community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../FAQs.html">xAH FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../API.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="library_root.html">Doxygen API</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">xAODAnaHelpers</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Program Listing for File BasicEventSelection.cxx</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/api/program_listing_file_Root_BasicEventSelection.cxx.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="program-listing-for-file-basiceventselection-cxx">
<span id="program-listing-file-root-basiceventselection-cxx"></span><h1>Program Listing for File BasicEventSelection.cxx<a class="headerlink" href="#program-listing-for-file-basiceventselection-cxx" title="Permalink to this headline">¶</a></h1>
<p>↰ <a class="reference internal" href="file_Root_BasicEventSelection.cxx.html#file-root-basiceventselection-cxx"><span class="std std-ref">Return to documentation for file</span></a> (<code class="docutils literal notranslate"><span class="pre">Root/BasicEventSelection.cxx</span></code>)</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// EL include(s):</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;EventLoop/Job.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;EventLoop/Worker.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;EventLoop/OutputStream.h&quot;</span>

<span class="c1">// EDM include(s):</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;xAODEventInfo/EventInfo.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;xAODTracking/VertexContainer.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;xAODCutFlow/CutBookkeeper.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;xAODCutFlow/CutBookkeeperContainer.h&quot;</span>

<span class="c1">// package include(s):</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;xAODAnaHelpers/HelperFunctions.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;xAODAnaHelpers/BasicEventSelection.h&gt;</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;PATInterfaces/CorrectionCode.h&quot;</span>
<span class="c1">//#include &quot;AsgMessaging/StatusCode.h&quot;</span>

<span class="c1">// tools</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;GoodRunsLists/GoodRunsListSelectionTool.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;PileupReweighting/PileupReweightingTool.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;TrigConfxAOD/xAODConfigTool.h&quot;</span>
<span class="c1">//#include &quot;PMGTools/PMGSherpa22VJetsWeightTool.h&quot;</span>

<span class="c1">// For reading metadata</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;AsgTools/AsgMetadataTool.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;xAODMetaData/FileMetaData.h&quot;</span>

<span class="c1">// ROOT include(s):</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;TFile.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;TTree.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;TTreeFormula.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;TSystem.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;xAODCore/tools/IOStats.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;xAODCore/tools/ReadStats.h&quot;</span>

<span class="c1">// this is needed to distribute the algorithm to the workers</span>
<span class="n">ClassImp</span><span class="p">(</span><span class="n">BasicEventSelection</span><span class="p">)</span>

<span class="n">BasicEventSelection</span><span class="w"> </span><span class="o">::</span><span class="w"> </span><span class="n">BasicEventSelection</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="o">:</span>
<span class="w">    </span><span class="n">Algorithm</span><span class="p">(</span><span class="s">&quot;BasicEventSelection&quot;</span><span class="p">)</span>
<span class="p">{</span>
<span class="p">}</span>


<span class="n">EL</span><span class="o">::</span><span class="n">StatusCode</span><span class="w"> </span><span class="n">BasicEventSelection</span><span class="w"> </span><span class="o">::</span><span class="w"> </span><span class="n">setupJob</span><span class="w"> </span><span class="p">(</span><span class="n">EL</span><span class="o">::</span><span class="n">Job</span><span class="o">&amp;</span><span class="w"> </span><span class="n">job</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="c1">// Here you put code that sets up the job on the submission object</span>
<span class="w">  </span><span class="c1">// so that it is ready to work with your algorithm, e.g. you can</span>
<span class="w">  </span><span class="c1">// request the D3PDReader service or add output files.  Any code you</span>
<span class="w">  </span><span class="c1">// put here could instead also go into the submission script.  The</span>
<span class="w">  </span><span class="c1">// sole advantage of putting it here is that it gets automatically</span>
<span class="w">  </span><span class="c1">// activated/deactivated when you add/remove the algorithm from your</span>
<span class="w">  </span><span class="c1">// job, which may or may not be of value to you.</span>
<span class="w">  </span><span class="c1">//</span>
<span class="w">  </span><span class="n">ANA_MSG_INFO</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;Calling setupJob&quot;</span><span class="p">);</span>

<span class="w">  </span><span class="n">job</span><span class="p">.</span><span class="n">useXAOD</span><span class="p">();</span>
<span class="w">  </span><span class="c1">// let&#39;s initialize the algorithm to use the xAODRootAccess package</span>
<span class="w">  </span><span class="n">xAOD</span><span class="o">::</span><span class="n">Init</span><span class="p">(</span><span class="s">&quot;BasicEventSelection&quot;</span><span class="p">).</span><span class="n">ignore</span><span class="p">();</span><span class="w"> </span><span class="c1">// call before opening first file</span>

<span class="w">  </span><span class="n">EL</span><span class="o">::</span><span class="n">OutputStream</span><span class="w"> </span><span class="nf">outForCFlow</span><span class="p">(</span><span class="n">m_cutFlowStreamName</span><span class="p">);</span>
<span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">job</span><span class="p">.</span><span class="n">outputHas</span><span class="p">(</span><span class="n">m_cutFlowStreamName</span><span class="p">)</span><span class="w"> </span><span class="p">){</span><span class="w"> </span><span class="n">job</span><span class="p">.</span><span class="n">outputAdd</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">outForCFlow</span><span class="w"> </span><span class="p">);</span><span class="w"> </span><span class="p">}</span>

<span class="w">  </span><span class="n">EL</span><span class="o">::</span><span class="n">OutputStream</span><span class="w"> </span><span class="n">outForMetadata</span><span class="p">(</span><span class="n">m_metaDataStreamName</span><span class="p">);</span>
<span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">job</span><span class="p">.</span><span class="n">outputHas</span><span class="p">(</span><span class="n">m_metaDataStreamName</span><span class="p">)</span><span class="w"> </span><span class="p">){</span><span class="w"> </span><span class="n">job</span><span class="p">.</span><span class="n">outputAdd</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">outForMetadata</span><span class="w"> </span><span class="p">);</span><span class="w"> </span><span class="p">}</span>

<span class="w">  </span><span class="n">EL</span><span class="o">::</span><span class="n">OutputStream</span><span class="w"> </span><span class="n">outForDuplicates</span><span class="p">(</span><span class="n">m_duplicatesStreamName</span><span class="p">);</span>
<span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">job</span><span class="p">.</span><span class="n">outputHas</span><span class="p">(</span><span class="n">m_duplicatesStreamName</span><span class="p">)</span><span class="w"> </span><span class="p">){</span><span class="w"> </span><span class="n">job</span><span class="p">.</span><span class="n">outputAdd</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">outForDuplicates</span><span class="w"> </span><span class="p">);</span><span class="w"> </span><span class="p">}</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">EL</span><span class="o">::</span><span class="n">StatusCode</span><span class="o">::</span><span class="n">SUCCESS</span><span class="p">;</span>
<span class="p">}</span>



<span class="n">EL</span><span class="o">::</span><span class="n">StatusCode</span><span class="w"> </span><span class="n">BasicEventSelection</span><span class="w"> </span><span class="o">::</span><span class="w"> </span><span class="n">histInitialize</span><span class="w"> </span><span class="p">()</span>
<span class="p">{</span>
<span class="w">  </span><span class="c1">// Here you do everything that needs to be done at the very</span>
<span class="w">  </span><span class="c1">// beginning on each worker node, e.g. create histograms and output</span>
<span class="w">  </span><span class="c1">// trees.  This method gets called before any input files are</span>
<span class="w">  </span><span class="c1">// connected.</span>

<span class="w">  </span><span class="n">ANA_MSG_INFO</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;Calling histInitialize&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="n">ANA_CHECK</span><span class="p">(</span><span class="w"> </span><span class="n">xAH</span><span class="o">::</span><span class="n">Algorithm</span><span class="o">::</span><span class="n">algInitialize</span><span class="p">());</span>

<span class="w">  </span><span class="c1">// write the metadata hist to this file so algos downstream can pick up the pointer</span>
<span class="w">  </span><span class="n">TFile</span><span class="w"> </span><span class="o">*</span><span class="n">fileMD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wk</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">getOutputFile</span><span class="w"> </span><span class="p">(</span><span class="n">m_metaDataStreamName</span><span class="p">);</span>
<span class="w">  </span><span class="n">fileMD</span><span class="o">-&gt;</span><span class="n">cd</span><span class="p">();</span>

<span class="w">  </span><span class="c1">// event counts from meta data</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="n">m_histEventCount</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">m_histEventCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">TH1D</span><span class="p">(</span><span class="s">&quot;MetaData_EventCount&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;MetaData_EventCount&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="mf">0.5</span><span class="p">,</span><span class="w"> </span><span class="mf">6.5</span><span class="p">);</span>
<span class="w">    </span><span class="n">m_histEventCount</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">GetXaxis</span><span class="p">()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">SetBinLabel</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;nEvents initial&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">m_histEventCount</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">GetXaxis</span><span class="p">()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">SetBinLabel</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;nEvents selected&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">m_histEventCount</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">GetXaxis</span><span class="p">()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">SetBinLabel</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;sumOfWeights initial&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">m_histEventCount</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">GetXaxis</span><span class="p">()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">SetBinLabel</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;sumOfWeights selected&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">m_histEventCount</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">GetXaxis</span><span class="p">()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">SetBinLabel</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;sumOfWeightsSquared initial&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">m_histEventCount</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">GetXaxis</span><span class="p">()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">SetBinLabel</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;sumOfWeightsSquared selected&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="n">TFile</span><span class="w"> </span><span class="o">*</span><span class="n">fileSumW</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wk</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">getOutputFile</span><span class="w"> </span><span class="p">(</span><span class="n">m_metaDataStreamName</span><span class="p">);</span>
<span class="w">  </span><span class="n">fileSumW</span><span class="o">-&gt;</span><span class="n">cd</span><span class="p">();</span>

<span class="w">  </span><span class="c1">// event counts from meta data</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="n">m_histSumW</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">m_histSumW</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">TH1D</span><span class="p">(</span><span class="s">&quot;MetaData_SumW&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;MetaData_SumW&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mf">-0.5</span><span class="p">,</span><span class="w"> </span><span class="mf">0.5</span><span class="p">);</span>
<span class="w">    </span><span class="n">m_histSumW</span><span class="o">-&gt;</span><span class="n">SetCanExtend</span><span class="p">(</span><span class="n">TH1</span><span class="o">::</span><span class="n">kAllAxes</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="n">ANA_MSG_INFO</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;Creating histograms&quot;</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// write the cutflows to this file so algos downstream can pick up the pointer</span>
<span class="w">  </span><span class="c1">//</span>
<span class="w">  </span><span class="n">TFile</span><span class="w"> </span><span class="o">*</span><span class="n">fileCF</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wk</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">getOutputFile</span><span class="w"> </span><span class="p">(</span><span class="n">m_cutFlowStreamName</span><span class="p">);</span>
<span class="w">  </span><span class="n">fileCF</span><span class="o">-&gt;</span><span class="n">cd</span><span class="p">();</span>

<span class="w">  </span><span class="c1">// Note: the following code is needed for anyone developing/running in ROOT 6.04.10+</span>
<span class="w">  </span><span class="c1">// Bin extension is not done anymore via TH1::SetBit(TH1::kCanRebin), but with TH1::SetCanExtend(TH1::kAllAxes)</span>

<span class="w">  </span><span class="c1">//initialise event cutflow, which will be picked ALSO by the algos downstream where an event selection is applied (or at least can be applied)</span>
<span class="w">  </span><span class="c1">//</span>
<span class="w">  </span><span class="c1">// use 1,1,2 so Fill(bin) and GetBinContent(bin) refer to the same bin</span>
<span class="w">  </span><span class="c1">//</span>
<span class="w">  </span><span class="n">m_cutflowHist</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">TH1D</span><span class="p">(</span><span class="s">&quot;cutflow&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;cutflow&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
<span class="w">  </span><span class="n">m_cutflowHist</span><span class="o">-&gt;</span><span class="n">SetCanExtend</span><span class="p">(</span><span class="n">TH1</span><span class="o">::</span><span class="n">kAllAxes</span><span class="p">);</span>
<span class="w">  </span><span class="c1">// use 1,1,2 so Fill(bin) and GetBinContent(bin) refer to the same bin</span>
<span class="w">  </span><span class="c1">//</span>
<span class="w">  </span><span class="n">m_cutflowHistW</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">TH1D</span><span class="p">(</span><span class="s">&quot;cutflow_weighted&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;cutflow_weighted&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
<span class="w">  </span><span class="n">m_cutflowHistW</span><span class="o">-&gt;</span><span class="n">SetCanExtend</span><span class="p">(</span><span class="n">TH1</span><span class="o">::</span><span class="n">kAllAxes</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// initialise object cutflows, which will be picked by the object selector algos downstream and filled.</span>
<span class="w">  </span><span class="c1">//</span>
<span class="w">  </span><span class="n">m_el_cutflowHist_1</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">TH1D</span><span class="p">(</span><span class="s">&quot;cutflow_electrons_1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;cutflow_electrons_1&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
<span class="w">  </span><span class="n">m_el_cutflowHist_1</span><span class="o">-&gt;</span><span class="n">SetCanExtend</span><span class="p">(</span><span class="n">TH1</span><span class="o">::</span><span class="n">kAllAxes</span><span class="p">);</span>
<span class="w">  </span><span class="n">m_el_cutflowHist_2</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">TH1D</span><span class="p">(</span><span class="s">&quot;cutflow_electrons_2&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;cutflow_electrons_2&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
<span class="w">  </span><span class="n">m_el_cutflowHist_2</span><span class="o">-&gt;</span><span class="n">SetCanExtend</span><span class="p">(</span><span class="n">TH1</span><span class="o">::</span><span class="n">kAllAxes</span><span class="p">);</span>
<span class="w">  </span><span class="n">m_mu_cutflowHist_1</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">TH1D</span><span class="p">(</span><span class="s">&quot;cutflow_muons_1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;cutflow_muons_1&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
<span class="w">  </span><span class="n">m_mu_cutflowHist_1</span><span class="o">-&gt;</span><span class="n">SetCanExtend</span><span class="p">(</span><span class="n">TH1</span><span class="o">::</span><span class="n">kAllAxes</span><span class="p">);</span>
<span class="w">  </span><span class="n">m_mu_cutflowHist_2</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">TH1D</span><span class="p">(</span><span class="s">&quot;cutflow_muons_2&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;cutflow_muons_2&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
<span class="w">  </span><span class="n">m_mu_cutflowHist_2</span><span class="o">-&gt;</span><span class="n">SetCanExtend</span><span class="p">(</span><span class="n">TH1</span><span class="o">::</span><span class="n">kAllAxes</span><span class="p">);</span>
<span class="w">  </span><span class="n">m_ph_cutflowHist_1</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">TH1D</span><span class="p">(</span><span class="s">&quot;cutflow_photons_1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;cutflow_photons_1&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
<span class="w">  </span><span class="n">m_ph_cutflowHist_1</span><span class="o">-&gt;</span><span class="n">SetCanExtend</span><span class="p">(</span><span class="n">TH1</span><span class="o">::</span><span class="n">kAllAxes</span><span class="p">);</span>
<span class="w">  </span><span class="n">m_tau_cutflowHist_1</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">TH1D</span><span class="p">(</span><span class="s">&quot;cutflow_taus_1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;cutflow_taus_1&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
<span class="w">  </span><span class="n">m_tau_cutflowHist_1</span><span class="o">-&gt;</span><span class="n">SetCanExtend</span><span class="p">(</span><span class="n">TH1</span><span class="o">::</span><span class="n">kAllAxes</span><span class="p">);</span>
<span class="w">  </span><span class="n">m_tau_cutflowHist_2</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">TH1D</span><span class="p">(</span><span class="s">&quot;cutflow_taus_2&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;cutflow_taus_2&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
<span class="w">  </span><span class="n">m_tau_cutflowHist_2</span><span class="o">-&gt;</span><span class="n">SetCanExtend</span><span class="p">(</span><span class="n">TH1</span><span class="o">::</span><span class="n">kAllAxes</span><span class="p">);</span>
<span class="w">  </span><span class="n">m_jet_cutflowHist_1</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">TH1D</span><span class="p">(</span><span class="s">&quot;cutflow_jets_1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;cutflow_jets_1&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
<span class="w">  </span><span class="n">m_jet_cutflowHist_1</span><span class="o">-&gt;</span><span class="n">SetCanExtend</span><span class="p">(</span><span class="n">TH1</span><span class="o">::</span><span class="n">kAllAxes</span><span class="p">);</span>
<span class="w">  </span><span class="n">m_trk_cutflowHist_1</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">TH1D</span><span class="p">(</span><span class="s">&quot;cutflow_trks_1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;cutflow_trks_1&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
<span class="w">  </span><span class="n">m_trk_cutflowHist_1</span><span class="o">-&gt;</span><span class="n">SetCanExtend</span><span class="p">(</span><span class="n">TH1</span><span class="o">::</span><span class="n">kAllAxes</span><span class="p">);</span>
<span class="w">  </span><span class="n">m_truth_cutflowHist_1</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">TH1D</span><span class="p">(</span><span class="s">&quot;cutflow_truths_1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;cutflow_truths_1&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
<span class="w">  </span><span class="n">m_truth_cutflowHist_1</span><span class="o">-&gt;</span><span class="n">SetCanExtend</span><span class="p">(</span><span class="n">TH1</span><span class="o">::</span><span class="n">kAllAxes</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// start labelling the bins for the event cutflow</span>
<span class="w">  </span><span class="c1">//</span>
<span class="w">  </span><span class="n">m_cutflow_all</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">m_cutflowHist</span><span class="o">-&gt;</span><span class="n">GetXaxis</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">FindBin</span><span class="p">(</span><span class="s">&quot;all&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="n">m_cutflowHistW</span><span class="o">-&gt;</span><span class="n">GetXaxis</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">FindBin</span><span class="p">(</span><span class="s">&quot;all&quot;</span><span class="p">);</span>

<span class="w">  </span><span class="n">m_cutflow_init</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">m_cutflowHist</span><span class="o">-&gt;</span><span class="n">GetXaxis</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">FindBin</span><span class="p">(</span><span class="s">&quot;init&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="n">m_cutflowHistW</span><span class="o">-&gt;</span><span class="n">GetXaxis</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">FindBin</span><span class="p">(</span><span class="s">&quot;init&quot;</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// extra cutflows</span>
<span class="w">  </span><span class="c1">// create histograms when m_doRunByRunCutflows is set to true</span>
<span class="w">  </span><span class="c1">// later check if !isMC() for filling so that these only get</span>
<span class="w">  </span><span class="c1">// filled when running on data</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">m_doRunByRunCutflows</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">m_runByrun_beforeCuts</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">TH1D</span><span class="p">(</span><span class="s">&quot;runByrun_cutflow_beforeCuts&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Run-by-Run cutflow before cuts&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
<span class="w">    </span><span class="n">m_runByrun_beforeCuts</span><span class="o">-&gt;</span><span class="n">SetCanExtend</span><span class="p">(</span><span class="n">TH1</span><span class="o">::</span><span class="n">kAllAxes</span><span class="p">);</span>

<span class="w">    </span><span class="n">m_runByrun_afterCuts</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">TH1D</span><span class="p">(</span><span class="s">&quot;runByrun_cutflow_afterCuts&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Run-by-Run cutflow after cuts&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
<span class="w">    </span><span class="n">m_runByrun_afterCuts</span><span class="o">-&gt;</span><span class="n">SetCanExtend</span><span class="p">(</span><span class="n">TH1</span><span class="o">::</span><span class="n">kAllAxes</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="n">ANA_MSG_INFO</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;Finished creating histograms&quot;</span><span class="p">);</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">EL</span><span class="o">::</span><span class="n">StatusCode</span><span class="o">::</span><span class="n">SUCCESS</span><span class="p">;</span>
<span class="p">}</span>


<span class="n">EL</span><span class="o">::</span><span class="n">StatusCode</span><span class="w"> </span><span class="n">BasicEventSelection</span><span class="w"> </span><span class="o">::</span><span class="w"> </span><span class="n">fileExecute</span><span class="w"> </span><span class="p">()</span>
<span class="p">{</span>
<span class="w">  </span><span class="c1">// Here you do everything that needs to be done exactly once for every</span>
<span class="w">  </span><span class="c1">// single file, e.g. collect a list of all lumi-blocks processed</span>

<span class="w">  </span><span class="n">ANA_MSG_INFO</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;Calling fileExecute&quot;</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// get TEvent and TStore - must be done here b/c we need to retrieve CutBookkeepers container from TEvent!</span>
<span class="w">  </span><span class="c1">//</span>
<span class="w">  </span><span class="n">m_event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wk</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">xaodEvent</span><span class="p">();</span>
<span class="w">  </span><span class="n">m_store</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wk</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">xaodStore</span><span class="p">();</span>

<span class="w">  </span><span class="c1">// get the MetaData tree once a new file is opened, with</span>
<span class="w">  </span><span class="c1">//</span>
<span class="w">  </span><span class="n">TTree</span><span class="o">*</span><span class="w"> </span><span class="n">MetaData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">dynamic_cast</span><span class="o">&lt;</span><span class="n">TTree</span><span class="o">*&gt;</span><span class="p">(</span><span class="w"> </span><span class="n">wk</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">inputFile</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">Get</span><span class="p">(</span><span class="s">&quot;MetaData&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">);</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="n">MetaData</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">ANA_MSG_ERROR</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;MetaData tree not found! Exiting.&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">EL</span><span class="o">::</span><span class="n">StatusCode</span><span class="o">::</span><span class="n">FAILURE</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="n">MetaData</span><span class="o">-&gt;</span><span class="n">LoadTree</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

<span class="w">  </span><span class="c1">//---------------------------</span>
<span class="w">  </span><span class="c1">// Meta data - CutBookkepers</span>
<span class="w">  </span><span class="c1">//---------------------------</span>
<span class="w">  </span><span class="c1">//</span>
<span class="w">  </span><span class="c1">// Metadata for intial N (weighted) events are used to correctly normalise MC</span>
<span class="w">  </span><span class="c1">// if running on a MC DAOD which had some skimming applied at the derivation stage</span>

<span class="w">  </span><span class="c1">//check if file is from a DxAOD</span>
<span class="w">  </span><span class="kt">bool</span><span class="w"> </span><span class="n">m_isDerivation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">!</span><span class="n">MetaData</span><span class="o">-&gt;</span><span class="n">GetBranch</span><span class="p">(</span><span class="s">&quot;StreamAOD&quot;</span><span class="p">);</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w">  </span><span class="n">m_useMetaData</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">      </span><span class="c1">// Check for potential file corruption</span>
<span class="w">      </span><span class="c1">//</span>
<span class="w">      </span><span class="c1">// If there are some Incomplete CBK, throw a WARNING,</span>
<span class="w">      </span><span class="c1">// unless ALL of them have inputStream == &quot;unknownStream&quot;</span>
<span class="w">      </span><span class="c1">//</span>
<span class="w">      </span><span class="k">const</span><span class="w"> </span><span class="n">xAOD</span><span class="o">::</span><span class="n">CutBookkeeperContainer</span><span class="o">*</span><span class="w"> </span><span class="nf">incompleteCBC</span><span class="p">(</span><span class="k">nullptr</span><span class="p">);</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="n">m_event</span><span class="o">-&gt;</span><span class="n">retrieveMetaInput</span><span class="p">(</span><span class="n">incompleteCBC</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;IncompleteCutBookkeepers&quot;</span><span class="p">).</span><span class="n">isSuccess</span><span class="p">()</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">ANA_MSG_ERROR</span><span class="p">(</span><span class="s">&quot;Failed to retrieve IncompleteCutBookkeepers from MetaData! Exiting.&quot;</span><span class="p">);</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="n">EL</span><span class="o">::</span><span class="n">StatusCode</span><span class="o">::</span><span class="n">FAILURE</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="kt">bool</span><span class="w"> </span><span class="n">allFromUnknownStream</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">incompleteCBC</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">stream</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">);</span>
<span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">cbk</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="o">*</span><span class="n">incompleteCBC</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="n">ANA_MSG_INFO</span><span class="p">(</span><span class="s">&quot;Incomplete cbk name: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">cbk</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; - stream: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">cbk</span><span class="o">-&gt;</span><span class="n">inputStream</span><span class="p">());</span>
<span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">cbk</span><span class="o">-&gt;</span><span class="n">inputStream</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s">&quot;unknownStream&quot;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="n">allFromUnknownStream</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">          </span><span class="n">stream</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cbk</span><span class="o">-&gt;</span><span class="n">inputStream</span><span class="p">();</span>
<span class="w">          </span><span class="k">break</span><span class="p">;</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="n">allFromUnknownStream</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">ANA_MSG_WARNING</span><span class="p">(</span><span class="s">&quot;Found incomplete CBK from stream: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">stream</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;. This is not necessarily a sign of file corruption (incomplete CBK appear when &#39;maxevents&#39; is set in the AOD jo, for instance), but you may still want to check input file for potential corruption...&quot;</span><span class="w"> </span><span class="p">);</span><span class="w"> </span><span class="p">}</span>

<span class="w">      </span><span class="p">}</span>

<span class="w">      </span><span class="c1">// Now, let&#39;s find the actual information</span>
<span class="w">      </span><span class="c1">//</span>
<span class="w">      </span><span class="k">const</span><span class="w"> </span><span class="n">xAOD</span><span class="o">::</span><span class="n">CutBookkeeperContainer</span><span class="o">*</span><span class="w"> </span><span class="n">completeCBC</span><span class="p">(</span><span class="k">nullptr</span><span class="p">);</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="n">m_event</span><span class="o">-&gt;</span><span class="n">retrieveMetaInput</span><span class="p">(</span><span class="n">completeCBC</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;CutBookkeepers&quot;</span><span class="p">).</span><span class="n">isSuccess</span><span class="p">()</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">ANA_MSG_ERROR</span><span class="p">(</span><span class="s">&quot;Failed to retrieve CutBookkeepers from MetaData! Exiting.&quot;</span><span class="p">);</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="n">EL</span><span class="o">::</span><span class="n">StatusCode</span><span class="o">::</span><span class="n">FAILURE</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>

<span class="w">      </span><span class="c1">// Find the smallest cycle number, the original first processing step/cycle</span>
<span class="w">      </span><span class="kt">int</span><span class="w"> </span><span class="n">minCycle</span><span class="p">(</span><span class="mi">10000</span><span class="p">);</span>
<span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">cbk</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="o">*</span><span class="n">completeCBC</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="p">(</span><span class="w"> </span><span class="n">cbk</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">().</span><span class="n">empty</span><span class="p">()</span><span class="w"> </span><span class="p">)</span><span class="w">  </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">minCycle</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">cbk</span><span class="o">-&gt;</span><span class="n">cycle</span><span class="p">()</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">){</span><span class="w"> </span><span class="n">minCycle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cbk</span><span class="o">-&gt;</span><span class="n">cycle</span><span class="p">();</span><span class="w"> </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>

<span class="w">      </span><span class="c1">// Now, let&#39;s actually find the right one that contains all the needed info...</span>
<span class="w">      </span><span class="k">const</span><span class="w"> </span><span class="n">xAOD</span><span class="o">::</span><span class="n">CutBookkeeper</span><span class="o">*</span><span class="w"> </span><span class="n">allEventsCBK</span><span class="p">(</span><span class="k">nullptr</span><span class="p">);</span>
<span class="w">      </span><span class="k">const</span><span class="w"> </span><span class="n">xAOD</span><span class="o">::</span><span class="n">CutBookkeeper</span><span class="o">*</span><span class="w"> </span><span class="nf">DxAODEventsCBK</span><span class="p">(</span><span class="k">nullptr</span><span class="p">);</span>

<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">m_isDerivation</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">m_derivationName</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">){</span>
<span class="w">      </span><span class="n">ANA_MSG_INFO</span><span class="p">(</span><span class="s">&quot;Override auto config to look at DAOD made by Derivation Algorithm: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">m_derivationName</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span><span class="k">else</span><span class="p">{</span>
<span class="w">      </span><span class="n">ANA_MSG_INFO</span><span class="p">(</span><span class="s">&quot;Will autoconfig to look at DAOD made by Derivation Algorithm.&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>

<span class="w">      </span><span class="kt">int</span><span class="w"> </span><span class="n">maxCycle</span><span class="p">(</span><span class="mi">-1</span><span class="p">);</span>
<span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">xAOD</span><span class="o">::</span><span class="n">CutBookkeeper</span><span class="o">*</span><span class="w"> </span><span class="n">cbk</span><span class="o">:</span><span class="w"> </span><span class="o">*</span><span class="n">completeCBC</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="c1">// Find initial book keeper</span>
<span class="w">      </span><span class="n">ANA_MSG_INFO</span><span class="p">(</span><span class="s">&quot;Complete cbk name: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">cbk</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; - stream: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">cbk</span><span class="o">-&gt;</span><span class="n">inputStream</span><span class="p">()</span><span class="w"> </span><span class="p">);</span>
<span class="w">      </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">cbk</span><span class="o">-&gt;</span><span class="n">cycle</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">maxCycle</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">cbk</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;AllExecutedEvents&quot;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">cbk</span><span class="o">-&gt;</span><span class="n">inputStream</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;StreamAOD&quot;</span><span class="w"> </span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="n">allEventsCBK</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cbk</span><span class="p">;</span>
<span class="w">          </span><span class="n">maxCycle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cbk</span><span class="o">-&gt;</span><span class="n">cycle</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">      </span><span class="c1">// Find derivation book keeper</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">m_isDerivation</span><span class="w"> </span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>

<span class="w">          </span><span class="k">if</span><span class="p">(</span><span class="n">m_derivationName</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">cbk</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">m_derivationName</span><span class="w"> </span><span class="p">)</span>
<span class="w">            </span><span class="n">DxAODEventsCBK</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cbk</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">          </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">cbk</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">().</span><span class="n">find</span><span class="p">(</span><span class="s">&quot;Kernel&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">::</span><span class="n">npos</span><span class="w"> </span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="n">ANA_MSG_INFO</span><span class="p">(</span><span class="s">&quot;Auto config found DAOD made by Derivation Algorithm: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">cbk</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">());</span>
<span class="w">          </span><span class="n">DxAODEventsCBK</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cbk</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="c1">// is derivation</span>

<span class="w">      </span><span class="c1">// Find and record AOD-level sumW information for all alternate weights</span>
<span class="w">      </span><span class="c1">//  The nominal AllExecutedEvents will be filled later, due to posibility of multiple CBK entries</span>
<span class="w">      </span><span class="k">if</span><span class="p">(</span><span class="n">cbk</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">().</span><span class="n">substr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">37</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;AllExecutedEvents_NonNominalMCWeight_&quot;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">cbk</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">().</span><span class="n">length</span><span class="p">()</span><span class="o">!=</span><span class="mi">17</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">cbk</span><span class="o">-&gt;</span><span class="n">inputStream</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;StreamAOD&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="c1">// Extract weight index from name</span>
<span class="w">          </span><span class="kt">int32_t</span><span class="w"> </span><span class="n">idx</span><span class="o">=</span><span class="n">std</span><span class="o">::</span><span class="n">stoi</span><span class="p">(</span><span class="n">cbk</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">().</span><span class="n">substr</span><span class="p">(</span><span class="mi">37</span><span class="p">));</span>

<span class="w">          </span><span class="c1">// Fill histogram, making sure that there is space</span>
<span class="w">          </span><span class="c1">// Note will fill bin index = idx+1</span>
<span class="w">          </span><span class="k">while</span><span class="p">(</span><span class="n">idx</span><span class="o">&gt;=</span><span class="n">m_histSumW</span><span class="o">-&gt;</span><span class="n">GetNbinsX</span><span class="p">())</span>
<span class="w">        </span><span class="n">m_histSumW</span><span class="o">-&gt;</span><span class="n">LabelsInflate</span><span class="p">(</span><span class="s">&quot;X&quot;</span><span class="p">);</span>
<span class="w">          </span><span class="n">m_histSumW</span><span class="o">-&gt;</span><span class="n">Fill</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span><span class="w"> </span><span class="n">cbk</span><span class="o">-&gt;</span><span class="n">sumOfEventWeights</span><span class="p">());</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">      </span><span class="k">if</span><span class="p">(</span><span class="n">allEventsCBK</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">ANA_MSG_WARNING</span><span class="p">(</span><span class="s">&quot;No allEventsCBK found (this is expected for DataScouting, otherwise not). Event numbers set to 0.&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">m_MD_initialNevents</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">        </span><span class="n">m_MD_initialSumW</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">        </span><span class="n">m_MD_initialSumWSquared</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">m_MD_initialNevents</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">allEventsCBK</span><span class="o">-&gt;</span><span class="n">nAcceptedEvents</span><span class="p">();</span>
<span class="w">        </span><span class="n">m_MD_initialSumW</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="n">allEventsCBK</span><span class="o">-&gt;</span><span class="n">sumOfEventWeights</span><span class="p">();</span>
<span class="w">        </span><span class="n">m_MD_initialSumWSquared</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">allEventsCBK</span><span class="o">-&gt;</span><span class="n">sumOfEventWeightsSquared</span><span class="p">();</span>
<span class="w">      </span><span class="p">}</span>

<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">m_isDerivation</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">DxAODEventsCBK</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">ANA_MSG_ERROR</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;No CutBookkeeper corresponds to the selected Derivation Framework algorithm name. Check it with your DF experts! Aborting.&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">EL</span><span class="o">::</span><span class="n">StatusCode</span><span class="o">::</span><span class="n">FAILURE</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>

<span class="w">      </span><span class="n">m_MD_finalNevents</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">m_isDerivation</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">DxAODEventsCBK</span><span class="o">-&gt;</span><span class="n">nAcceptedEvents</span><span class="p">()</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">m_MD_initialNevents</span><span class="p">;</span>
<span class="w">      </span><span class="n">m_MD_finalSumW</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">m_isDerivation</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">DxAODEventsCBK</span><span class="o">-&gt;</span><span class="n">sumOfEventWeights</span><span class="p">()</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">m_MD_initialSumW</span><span class="p">;</span>
<span class="w">      </span><span class="n">m_MD_finalSumWSquared</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">m_isDerivation</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">DxAODEventsCBK</span><span class="o">-&gt;</span><span class="n">sumOfEventWeightsSquared</span><span class="p">()</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">m_MD_initialSumWSquared</span><span class="p">;</span>

<span class="w">      </span><span class="c1">// Write metadata event bookkeepers to histogram</span>
<span class="w">      </span><span class="c1">//</span>
<span class="w">      </span><span class="n">ANA_MSG_INFO</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;Meta data from this file:&quot;</span><span class="p">);</span>
<span class="w">      </span><span class="n">ANA_MSG_INFO</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;Initial  events  = &quot;</span><span class="w">                </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">m_MD_initialNevents</span><span class="p">)</span><span class="w"> </span><span class="p">);</span>
<span class="w">      </span><span class="n">ANA_MSG_INFO</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;Selected events  = &quot;</span><span class="w">                </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">m_MD_finalNevents</span><span class="p">)</span><span class="w"> </span><span class="p">);</span>
<span class="w">      </span><span class="n">ANA_MSG_INFO</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;Initial  sum of weights = &quot;</span><span class="w">         </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">m_MD_initialSumW</span><span class="p">);</span>
<span class="w">      </span><span class="n">ANA_MSG_INFO</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;Selected sum of weights = &quot;</span><span class="w">         </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">m_MD_finalSumW</span><span class="p">);</span>
<span class="w">      </span><span class="n">ANA_MSG_INFO</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;Initial  sum of weights squared = &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">m_MD_initialSumWSquared</span><span class="p">);</span>
<span class="w">      </span><span class="n">ANA_MSG_INFO</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;Selected sum of weights squared = &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">m_MD_finalSumWSquared</span><span class="p">);</span>

<span class="w">      </span><span class="n">m_cutflowHist</span><span class="w"> </span><span class="o">-&gt;</span><span class="n">Fill</span><span class="p">(</span><span class="n">m_cutflow_all</span><span class="p">,</span><span class="w"> </span><span class="n">m_MD_initialNevents</span><span class="p">);</span>
<span class="w">      </span><span class="n">m_cutflowHistW</span><span class="o">-&gt;</span><span class="n">Fill</span><span class="p">(</span><span class="n">m_cutflow_all</span><span class="p">,</span><span class="w"> </span><span class="n">m_MD_initialSumW</span><span class="p">);</span>

<span class="w">      </span><span class="n">m_histSumW</span><span class="o">-&gt;</span><span class="n">Fill</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="n">m_MD_initialSumW</span><span class="p">);</span>

<span class="w">      </span><span class="n">m_histEventCount</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Fill</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">m_MD_initialNevents</span><span class="p">);</span>
<span class="w">      </span><span class="n">m_histEventCount</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Fill</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">m_MD_finalNevents</span><span class="p">);</span>
<span class="w">      </span><span class="n">m_histEventCount</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Fill</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">m_MD_initialSumW</span><span class="p">);</span>
<span class="w">      </span><span class="n">m_histEventCount</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Fill</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="n">m_MD_finalSumW</span><span class="p">);</span>
<span class="w">      </span><span class="n">m_histEventCount</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Fill</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="n">m_MD_initialSumWSquared</span><span class="p">);</span>
<span class="w">      </span><span class="n">m_histEventCount</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Fill</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="n">m_MD_finalSumWSquared</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">EL</span><span class="o">::</span><span class="n">StatusCode</span><span class="o">::</span><span class="n">SUCCESS</span><span class="p">;</span>

<span class="p">}</span>

<span class="n">EL</span><span class="o">::</span><span class="n">StatusCode</span><span class="w"> </span><span class="n">BasicEventSelection</span><span class="w"> </span><span class="o">::</span><span class="w"> </span><span class="n">changeInput</span><span class="w"> </span><span class="p">(</span><span class="kt">bool</span><span class="w"> </span><span class="cm">/*firstFile*/</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="c1">// Here you do everything you need to do when we change input files,</span>
<span class="w">  </span><span class="c1">// e.g. resetting branch addresses on trees.  If you are using</span>
<span class="w">  </span><span class="c1">// D3PDReader or a similar service this method is not needed.</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">EL</span><span class="o">::</span><span class="n">StatusCode</span><span class="o">::</span><span class="n">SUCCESS</span><span class="p">;</span>
<span class="p">}</span>



<span class="n">EL</span><span class="o">::</span><span class="n">StatusCode</span><span class="w"> </span><span class="n">BasicEventSelection</span><span class="w"> </span><span class="o">::</span><span class="w"> </span><span class="n">initialize</span><span class="w"> </span><span class="p">()</span>
<span class="p">{</span>
<span class="w">  </span><span class="c1">// Here you do everything that you need to do after the first input</span>
<span class="w">  </span><span class="c1">// file has been connected and before the first event is processed,</span>
<span class="w">  </span><span class="c1">// e.g. create additional histograms based on which variables are</span>
<span class="w">  </span><span class="c1">// available in the input files.  You can also create all of your</span>
<span class="w">  </span><span class="c1">// histograms and trees in here, but be aware that this method</span>
<span class="w">  </span><span class="c1">// doesn&#39;t get called if no events are processed.  So any objects</span>
<span class="w">  </span><span class="c1">// you create here won&#39;t be available in the output if you have no</span>
<span class="w">  </span><span class="c1">// input events.</span>

<span class="w">  </span><span class="n">ANA_MSG_INFO</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;Initializing BasicEventSelection... &quot;</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// if truth level make sure parameters are set properly</span>
<span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">m_truthLevelOnly</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">ANA_MSG_INFO</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;Truth only! Turn off trigger stuff&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">m_triggerSelection</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="n">m_extraTriggerSelection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="n">m_applyTriggerCut</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_storeTrigDecisions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_storePassL1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_storePassHLT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_storeTrigKeys</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">    </span><span class="n">ANA_MSG_INFO</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;Truth only! Turn off GRL&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">m_applyGRLCut</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">    </span><span class="n">ANA_MSG_INFO</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;Truth only! Turn off Pile-up Reweight&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">m_doPUreweighting</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">    </span><span class="n">m_doPUreweightingSys</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="c1">// get TEvent and TStore</span>
<span class="w">  </span><span class="c1">//</span>
<span class="w">  </span><span class="n">m_event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wk</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">xaodEvent</span><span class="p">();</span>
<span class="w">  </span><span class="n">m_store</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wk</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">xaodStore</span><span class="p">();</span>

<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="n">xAOD</span><span class="o">::</span><span class="n">EventInfo</span><span class="o">*</span><span class="w"> </span><span class="nf">eventInfo</span><span class="p">(</span><span class="k">nullptr</span><span class="p">);</span>
<span class="w">  </span><span class="n">ANA_CHECK</span><span class="p">(</span><span class="w"> </span><span class="n">HelperFunctions</span><span class="o">::</span><span class="n">retrieve</span><span class="p">(</span><span class="n">eventInfo</span><span class="p">,</span><span class="w"> </span><span class="n">m_eventInfoContainerName</span><span class="p">,</span><span class="w"> </span><span class="n">m_event</span><span class="p">,</span><span class="w"> </span><span class="n">m_store</span><span class="p">,</span><span class="w"> </span><span class="n">msg</span><span class="p">())</span><span class="w"> </span><span class="p">);</span>

<span class="w">  </span><span class="n">ANA_MSG_DEBUG</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;Is MC? &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">isMC</span><span class="p">()</span><span class="w"> </span><span class="p">);</span>

<span class="w">  </span><span class="c1">//Protection in case GRL does not apply to this run</span>
<span class="w">  </span><span class="c1">//</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">m_applyGRLCut</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">runNumString</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="n">eventInfo</span><span class="o">-&gt;</span><span class="n">runNumber</span><span class="p">());</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">m_GRLExcludeList</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="w"> </span><span class="n">runNumString</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">::</span><span class="n">npos</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">ANA_MSG_INFO</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;RunNumber is in GRLExclusion list, setting applyGRL to false&quot;</span><span class="p">);</span>
<span class="w">      </span><span class="n">m_applyGRLCut</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="n">m_cleanPowheg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">eventInfo</span><span class="o">-&gt;</span><span class="n">runNumber</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">426005</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// Powheg+Pythia J5</span>
<span class="w">    </span><span class="n">m_cleanPowheg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">    </span><span class="n">ANA_MSG_INFO</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;This is J5 Powheg - cleaning that nasty huge weight event&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>


<span class="w">  </span><span class="c1">// https://twiki.cern.ch/twiki/bin/viewauth/AtlasProtected/CentralMC15ProductionList#Sherpa_v2_2_0_V_jets_NJet_reweig</span>
<span class="w">  </span><span class="c1">//m_reweightSherpa22 = false;</span>
<span class="w">  </span><span class="c1">//if( isMC() &amp;&amp;</span>
<span class="w">  </span><span class="c1">//    ( (eventInfo-&gt;mcChannelNumber() &gt;= 363331 &amp;&amp; eventInfo-&gt;mcChannelNumber() &lt;= 363483 ) ||</span>
<span class="w">  </span><span class="c1">//      (eventInfo-&gt;mcChannelNumber() &gt;= 363102 &amp;&amp; eventInfo-&gt;mcChannelNumber() &lt;= 363122 ) ||</span>
<span class="w">  </span><span class="c1">//      (eventInfo-&gt;mcChannelNumber() &gt;= 363361 &amp;&amp; eventInfo-&gt;mcChannelNumber() &lt;= 363435 ) ) ){</span>
<span class="w">  </span><span class="c1">//  ANA_MSG_INFO( &quot;This is Sherpa 2.2 dataset and should be reweighted.  An extra weight will be saved to EventInfo called \&quot;weight_Sherpa22\&quot;.&quot;);</span>
<span class="w">  </span><span class="c1">//  m_reweightSherpa22 = true;</span>

<span class="w">  </span><span class="c1">//  //Choose Jet Truth container, WZ has more information and is favored by the tool</span>
<span class="w">  </span><span class="c1">//  std::string pmg_TruthJetContainer = &quot;&quot;;</span>
<span class="w">  </span><span class="c1">//  if( m_event-&gt;contains&lt;xAOD::JetContainer&gt;(&quot;AntiKt4TruthWZJets&quot;) ){</span>
<span class="w">  </span><span class="c1">//    pmg_TruthJetContainer = &quot;AntiKt4TruthWZJets&quot;;</span>
<span class="w">  </span><span class="c1">//  } else if( m_event-&gt;contains&lt;xAOD::JetContainer&gt;(&quot;AntiKt4TruthJets&quot;) ){</span>
<span class="w">  </span><span class="c1">//    pmg_TruthJetContainer = &quot;AntiKt4TruthJets&quot;;</span>
<span class="w">  </span><span class="c1">//  } else {</span>
<span class="w">  </span><span class="c1">//    ANA_MSG_WARNING( &quot;No Truth Jet Container found for Sherpa 22 reweighting, weight_Sherpa22 will not be set.&quot;);</span>
<span class="w">  </span><span class="c1">//    m_reweightSherpa22 = false;</span>
<span class="w">  </span><span class="c1">//  }</span>

<span class="w">  </span><span class="c1">//  //Initialize Tool</span>
<span class="w">  </span><span class="c1">//  if( m_reweightSherpa22 ){</span>

<span class="w">  </span><span class="c1">//    ANA_CHECK( m_reweightSherpa22_tool_handle.setProperty( &quot;TruthJetContainer&quot;, pmg_TruthJetContainer ));</span>
<span class="w">  </span><span class="c1">//    ANA_CHECK( m_reweightSherpa22_tool_handle.setProperty( &quot;OutputLevel&quot;, msg().level() ));</span>
<span class="w">  </span><span class="c1">//    ANA_CHECK( m_reweightSherpa22_tool_handle.retrieve());</span>
<span class="w">  </span><span class="c1">//    ANA_MSG_DEBUG(&quot;Retrieved tool: &quot; &lt;&lt; m_reweightSherpa22_tool_handle);</span>

<span class="w">  </span><span class="c1">//  }</span>
<span class="w">  </span><span class="c1">//}//if isMC and a Sherpa 2.2 sample</span>

<span class="w">  </span><span class="n">ANA_MSG_INFO</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;Setting up histograms based on isMC()&quot;</span><span class="p">);</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="n">isMC</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">m_checkDuplicatesData</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">isMC</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">m_checkDuplicatesMC</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">m_cutflow_duplicates</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">m_cutflowHist</span><span class="o">-&gt;</span><span class="n">GetXaxis</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">FindBin</span><span class="p">(</span><span class="s">&quot;Duplicates&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">m_cutflowHistW</span><span class="o">-&gt;</span><span class="n">GetXaxis</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">FindBin</span><span class="p">(</span><span class="s">&quot;Duplicates&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="n">isMC</span><span class="p">()</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">m_applyGRLCut</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">m_cutflow_grl</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">m_cutflowHist</span><span class="o">-&gt;</span><span class="n">GetXaxis</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">FindBin</span><span class="p">(</span><span class="s">&quot;GRL&quot;</span><span class="p">);</span>
<span class="w">      </span><span class="n">m_cutflowHistW</span><span class="o">-&gt;</span><span class="n">GetXaxis</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">FindBin</span><span class="p">(</span><span class="s">&quot;GRL&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">m_cutflow_lar</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">m_cutflowHist</span><span class="o">-&gt;</span><span class="n">GetXaxis</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">FindBin</span><span class="p">(</span><span class="s">&quot;LAr&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">m_cutflowHistW</span><span class="o">-&gt;</span><span class="n">GetXaxis</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">FindBin</span><span class="p">(</span><span class="s">&quot;LAr&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">m_cutflow_tile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_cutflowHist</span><span class="o">-&gt;</span><span class="n">GetXaxis</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">FindBin</span><span class="p">(</span><span class="s">&quot;tile&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">m_cutflowHistW</span><span class="o">-&gt;</span><span class="n">GetXaxis</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">FindBin</span><span class="p">(</span><span class="s">&quot;tile&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">m_cutflow_SCT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_cutflowHist</span><span class="o">-&gt;</span><span class="n">GetXaxis</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">FindBin</span><span class="p">(</span><span class="s">&quot;SCT&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">m_cutflowHistW</span><span class="o">-&gt;</span><span class="n">GetXaxis</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">FindBin</span><span class="p">(</span><span class="s">&quot;SCT&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">m_cutflow_core</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_cutflowHist</span><span class="o">-&gt;</span><span class="n">GetXaxis</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">FindBin</span><span class="p">(</span><span class="s">&quot;core&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">m_cutflowHistW</span><span class="o">-&gt;</span><span class="n">GetXaxis</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">FindBin</span><span class="p">(</span><span class="s">&quot;core&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">m_applyJetCleaningEventFlag</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">m_cutflow_jetcleaning</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_cutflowHist</span><span class="o">-&gt;</span><span class="n">GetXaxis</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">FindBin</span><span class="p">(</span><span class="s">&quot;JetCleaning&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">m_cutflowHistW</span><span class="o">-&gt;</span><span class="n">GetXaxis</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">FindBin</span><span class="p">(</span><span class="s">&quot;JetCleaning&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="n">isMC</span><span class="p">()</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">m_applyIsBadBatmanFlag</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">m_cutflow_isbadbatman</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="n">m_cutflowHist</span><span class="o">-&gt;</span><span class="n">GetXaxis</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">FindBin</span><span class="p">(</span><span class="s">&quot;IsBadBatman&quot;</span><span class="p">);</span>
<span class="w">      </span><span class="n">m_cutflowHistW</span><span class="o">-&gt;</span><span class="n">GetXaxis</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">FindBin</span><span class="p">(</span><span class="s">&quot;IsBadBatman&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="n">m_cutflow_npv</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">m_cutflowHist</span><span class="o">-&gt;</span><span class="n">GetXaxis</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">FindBin</span><span class="p">(</span><span class="s">&quot;NPV&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="n">m_cutflowHistW</span><span class="o">-&gt;</span><span class="n">GetXaxis</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">FindBin</span><span class="p">(</span><span class="s">&quot;NPV&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="n">m_triggerSelection</span><span class="p">.</span><span class="n">empty</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">m_applyTriggerCut</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">m_cutflow_trigger</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">m_cutflowHist</span><span class="o">-&gt;</span><span class="n">GetXaxis</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">FindBin</span><span class="p">(</span><span class="s">&quot;Trigger&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">m_cutflowHistW</span><span class="o">-&gt;</span><span class="n">GetXaxis</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">FindBin</span><span class="p">(</span><span class="s">&quot;Trigger&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="n">ANA_MSG_INFO</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;Histograms set up!&quot;</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// -------------------------------------------------------------------------------------------------</span>

<span class="w">  </span><span class="c1">// Create TTree for bookeeeping duplicated events</span>
<span class="w">  </span><span class="c1">//</span>
<span class="w">  </span><span class="n">TFile</span><span class="w"> </span><span class="o">*</span><span class="n">fileDPL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wk</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">getOutputFile</span><span class="w"> </span><span class="p">(</span><span class="n">m_duplicatesStreamName</span><span class="p">);</span>
<span class="w">  </span><span class="n">fileDPL</span><span class="o">-&gt;</span><span class="n">cd</span><span class="p">();</span>

<span class="w">  </span><span class="n">m_duplicatesTree</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">TTree</span><span class="p">(</span><span class="s">&quot;duplicates&quot;</span><span class="p">,</span><span class="s">&quot;Info on duplicated events&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="n">m_duplicatesTree</span><span class="o">-&gt;</span><span class="n">Branch</span><span class="p">(</span><span class="s">&quot;runNumber&quot;</span><span class="p">,</span><span class="w">    </span><span class="o">&amp;</span><span class="n">m_duplRunNumber</span><span class="p">,</span><span class="w">      </span><span class="s">&quot;runNumber/I&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="n">m_duplicatesTree</span><span class="o">-&gt;</span><span class="n">Branch</span><span class="p">(</span><span class="s">&quot;eventNumber&quot;</span><span class="p">,</span><span class="w">  </span><span class="o">&amp;</span><span class="n">m_duplEventNumber</span><span class="p">,</span><span class="w">    </span><span class="s">&quot;eventNumber/L&quot;</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// -------------------------------------------------------------------------------------------------</span>

<span class="w">  </span><span class="n">ANA_MSG_INFO</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;Setting Up Tools&quot;</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// 1.</span>
<span class="w">  </span><span class="c1">// initialize the GoodRunsListSelectionTool</span>
<span class="w">  </span><span class="c1">//</span>

<span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="n">m_applyGRLCut</span><span class="p">){</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">vecStringGRL</span><span class="p">;</span>

<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">grl</span><span class="p">;</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">istringstream</span><span class="w"> </span><span class="nf">ss</span><span class="p">(</span><span class="n">m_GRLxml</span><span class="p">);</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">getline</span><span class="p">(</span><span class="n">ss</span><span class="p">,</span><span class="w"> </span><span class="n">grl</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39;,&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PathResolverFindCalibFile</span><span class="p">(</span><span class="n">grl</span><span class="p">);</span>
<span class="w">        </span><span class="n">ANA_MSG_DEBUG</span><span class="p">(</span><span class="s">&quot;Found GRL: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">file</span><span class="p">);</span>
<span class="w">        </span><span class="n">vecStringGRL</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">file</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">ANA_CHECK</span><span class="p">(</span><span class="w"> </span><span class="n">m_grl_handle</span><span class="p">.</span><span class="n">setProperty</span><span class="p">(</span><span class="s">&quot;GoodRunsListVec&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">vecStringGRL</span><span class="p">));</span>
<span class="w">    </span><span class="n">ANA_CHECK</span><span class="p">(</span><span class="w"> </span><span class="n">m_grl_handle</span><span class="p">.</span><span class="n">setProperty</span><span class="p">(</span><span class="s">&quot;PassThrough&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">));</span>
<span class="w">    </span><span class="n">ANA_CHECK</span><span class="p">(</span><span class="w"> </span><span class="n">m_grl_handle</span><span class="p">.</span><span class="n">setProperty</span><span class="p">(</span><span class="s">&quot;OutputLevel&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">msg</span><span class="p">().</span><span class="n">level</span><span class="p">()));</span>
<span class="w">    </span><span class="n">ANA_CHECK</span><span class="p">(</span><span class="w"> </span><span class="n">m_grl_handle</span><span class="p">.</span><span class="n">retrieve</span><span class="p">());</span>
<span class="w">    </span><span class="n">ANA_MSG_DEBUG</span><span class="p">(</span><span class="s">&quot;Retrieved tool: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">m_grl_handle</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="c1">// 2.</span>
<span class="w">  </span><span class="c1">// initialize the Trig::TrigDecisionTool</span>
<span class="w">  </span><span class="c1">//</span>
<span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="n">m_triggerSelection</span><span class="p">.</span><span class="n">empty</span><span class="p">()</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">!</span><span class="n">m_extraTriggerSelection</span><span class="p">.</span><span class="n">empty</span><span class="p">()</span><span class="w"> </span><span class="o">||</span>
<span class="w">      </span><span class="n">m_applyTriggerCut</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">m_storeTrigDecisions</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">m_storePassL1</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">m_storePassHLT</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">m_storeTrigKeys</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="n">ANA_CHECK</span><span class="p">(</span><span class="w"> </span><span class="n">m_trigConfTool_handle</span><span class="p">.</span><span class="n">setProperty</span><span class="p">(</span><span class="s">&quot;OutputLevel&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">msg</span><span class="p">().</span><span class="n">level</span><span class="p">()));</span>
<span class="w">    </span><span class="n">ANA_CHECK</span><span class="p">(</span><span class="w"> </span><span class="n">m_trigConfTool_handle</span><span class="p">.</span><span class="n">retrieve</span><span class="p">());</span>
<span class="w">    </span><span class="n">ANA_MSG_DEBUG</span><span class="p">(</span><span class="s">&quot;Retrieved tool: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">m_trigConfTool_handle</span><span class="p">);</span>

<span class="w">    </span><span class="n">ANA_CHECK</span><span class="p">(</span><span class="w"> </span><span class="n">m_trigDecTool_handle</span><span class="p">.</span><span class="n">setProperty</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;ConfigTool&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">m_trigConfTool_handle</span><span class="w"> </span><span class="p">));</span>
<span class="w">    </span><span class="n">ANA_CHECK</span><span class="p">(</span><span class="w"> </span><span class="n">m_trigDecTool_handle</span><span class="p">.</span><span class="n">setProperty</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;TrigDecisionKey&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;xTrigDecision&quot;</span><span class="w"> </span><span class="p">));</span>
<span class="w">    </span><span class="n">ANA_CHECK</span><span class="p">(</span><span class="w"> </span><span class="n">m_trigDecTool_handle</span><span class="p">.</span><span class="n">setProperty</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;OutputLevel&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">msg</span><span class="p">().</span><span class="n">level</span><span class="p">()</span><span class="w"> </span><span class="p">));</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">m_useRun3navigation</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="n">ANA_CHECK</span><span class="p">(</span><span class="w"> </span><span class="n">m_trigDecTool_handle</span><span class="p">.</span><span class="n">setProperty</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;NavigationFormat&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;TrigComposite&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">);</span>
<span class="w">      </span><span class="n">ANA_CHECK</span><span class="p">(</span><span class="w"> </span><span class="n">m_trigDecTool_handle</span><span class="p">.</span><span class="n">setProperty</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;HLTSummary&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">m_HLTSummary</span><span class="p">)</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">ANA_CHECK</span><span class="p">(</span><span class="w"> </span><span class="n">m_trigDecTool_handle</span><span class="p">.</span><span class="n">setProperty</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;NavigationFormat&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;TriggerElement&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">ANA_CHECK</span><span class="p">(</span><span class="w"> </span><span class="n">m_trigDecTool_handle</span><span class="p">.</span><span class="n">retrieve</span><span class="p">());</span>
<span class="w">    </span><span class="n">ANA_MSG_DEBUG</span><span class="p">(</span><span class="s">&quot;Retrieved tool: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">m_trigDecTool_handle</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// parse extra triggers list and split by comma</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">token</span><span class="p">;</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">istringstream</span><span class="w"> </span><span class="nf">ss</span><span class="p">(</span><span class="n">m_extraTriggerSelection</span><span class="p">);</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">getline</span><span class="p">(</span><span class="n">ss</span><span class="p">,</span><span class="w"> </span><span class="n">token</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39;,&#39;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">m_extraTriggerSelectionList</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">token</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span><span class="c1">//end trigger configuration</span>

<span class="w">  </span><span class="c1">// 3.</span>
<span class="w">  </span><span class="c1">// initialize the CP::PileupReweightingTool</span>
<span class="w">  </span><span class="c1">//</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">m_doPUreweighting</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">PRWFiles</span><span class="p">;</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">lumiCalcFiles</span><span class="p">;</span>

<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">tmp_lumiCalcFileNames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_lumiCalcFileNames</span><span class="p">;</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">tmp_PRWFileNames</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="n">m_PRWFileNames</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Parse all comma seperated files</span>
<span class="w">    </span><span class="c1">//</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">tmp_PRWFileNames</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="kt">size_t</span><span class="w"> </span><span class="n">pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tmp_PRWFileNames</span><span class="p">.</span><span class="n">find_first_of</span><span class="p">(</span><span class="sc">&#39;,&#39;</span><span class="p">);</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">pos</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">::</span><span class="n">npos</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tmp_PRWFileNames</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
<span class="w">        </span><span class="n">PRWFiles</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">tmp_PRWFileNames</span><span class="p">.</span><span class="n">substr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">pos</span><span class="p">));</span>
<span class="w">        </span><span class="n">tmp_PRWFileNames</span><span class="p">.</span><span class="n">erase</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">pos</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">PRWFiles</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">tmp_PRWFileNames</span><span class="p">.</span><span class="n">substr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">pos</span><span class="p">));</span>
<span class="w">        </span><span class="n">tmp_PRWFileNames</span><span class="p">.</span><span class="n">erase</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">pos</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">tmp_lumiCalcFileNames</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="kt">size_t</span><span class="w"> </span><span class="n">pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tmp_lumiCalcFileNames</span><span class="p">.</span><span class="n">find_first_of</span><span class="p">(</span><span class="sc">&#39;,&#39;</span><span class="p">);</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">pos</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">::</span><span class="n">npos</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tmp_lumiCalcFileNames</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
<span class="w">        </span><span class="n">lumiCalcFiles</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">tmp_lumiCalcFileNames</span><span class="p">.</span><span class="n">substr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">pos</span><span class="p">));</span>
<span class="w">        </span><span class="n">tmp_lumiCalcFileNames</span><span class="p">.</span><span class="n">erase</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">pos</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">lumiCalcFiles</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">tmp_lumiCalcFileNames</span><span class="p">.</span><span class="n">substr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">pos</span><span class="p">));</span>
<span class="w">        </span><span class="n">tmp_lumiCalcFileNames</span><span class="p">.</span><span class="n">erase</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">pos</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Find trigger specific lumicalc files</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="n">isMC</span><span class="p">()</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">lumiCalcFile</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">lumiCalcFiles</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">size_t</span><span class="w"> </span><span class="n">pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lumiCalcFile</span><span class="p">.</span><span class="n">find_first_of</span><span class="p">(</span><span class="sc">&#39;:&#39;</span><span class="p">);</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">pos</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">::</span><span class="n">npos</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="n">m_triggerUnprescaleList</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">lumiCalcFile</span><span class="p">.</span><span class="n">substr</span><span class="p">(</span><span class="n">pos</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">));</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>

<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="n">m_triggerUnprescaleList</span><span class="p">.</span><span class="n">empty</span><span class="p">()</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">ANA_MSG_INFO</span><span class="p">(</span><span class="s">&quot;*** Trigger chains used for data unprescaling:&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">trigger</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">m_triggerUnprescaleList</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="n">ANA_MSG_INFO</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\t</span><span class="s"> &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">trigger</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">m_autoconfigPRW</span><span class="p">)</span>
<span class="w">      </span><span class="p">{</span><span class="w"> </span><span class="n">ANA_CHECK</span><span class="p">(</span><span class="w"> </span><span class="n">autoconfigurePileupRWTool</span><span class="p">()</span><span class="w"> </span><span class="p">);</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="k">else</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">isMC</span><span class="p">()</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="n">ANA_MSG_INFO</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;Adding Pileup files for CP::PileupReweightingTool:&quot;</span><span class="p">);</span>
<span class="w">          </span><span class="k">for</span><span class="p">(</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">PRWFiles</span><span class="p">.</span><span class="n">size</span><span class="p">();</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">){</span>
<span class="w">            </span><span class="n">ANA_MSG_INFO</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\t</span><span class="s">- &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">PRWFiles</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">c_str</span><span class="p">());</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">          </span><span class="n">ANA_CHECK</span><span class="p">(</span><span class="w"> </span><span class="n">m_pileup_tool_handle</span><span class="p">.</span><span class="n">setProperty</span><span class="p">(</span><span class="s">&quot;ConfigFiles&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">PRWFiles</span><span class="p">));</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="n">ANA_MSG_INFO</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;Adding LumiCalc files for CP::PileupReweightingTool:&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="k">for</span><span class="p">(</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">lumiCalcFiles</span><span class="p">.</span><span class="n">size</span><span class="p">();</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">){</span>
<span class="w">          </span><span class="n">ANA_MSG_INFO</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\t</span><span class="s">- &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">lumiCalcFiles</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">c_str</span><span class="p">());</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">ANA_CHECK</span><span class="p">(</span><span class="w"> </span><span class="n">m_pileup_tool_handle</span><span class="p">.</span><span class="n">setProperty</span><span class="p">(</span><span class="s">&quot;LumiCalcFiles&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">lumiCalcFiles</span><span class="p">));</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="n">ANA_CHECK</span><span class="p">(</span><span class="w"> </span><span class="n">m_pileup_tool_handle</span><span class="p">.</span><span class="n">setProperty</span><span class="p">(</span><span class="s">&quot;UsePeriodConfig&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">m_periodConfig</span><span class="p">)</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="n">ANA_CHECK</span><span class="p">(</span><span class="w"> </span><span class="n">m_pileup_tool_handle</span><span class="p">.</span><span class="n">setProperty</span><span class="p">(</span><span class="s">&quot;OutputLevel&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">msg</span><span class="p">().</span><span class="n">level</span><span class="p">()</span><span class="w"> </span><span class="p">));</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="n">m_triggerUnprescaleList</span><span class="p">.</span><span class="n">empty</span><span class="p">()</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="c1">// We need to make an instance of ITrigDecisionTool:</span>
<span class="w">      </span><span class="n">asg</span><span class="o">::</span><span class="n">AnaToolHandle</span><span class="o">&lt;</span><span class="n">Trig</span><span class="o">::</span><span class="n">ITrigDecisionTool</span><span class="o">&gt;</span><span class="w"> </span><span class="n">iTrigDecTool_handle</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;Trig::TrigDecisionTool/TrigDecisionTool&quot;</span><span class="p">};</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="n">iTrigDecTool_handle</span><span class="p">.</span><span class="n">isUserConfigured</span><span class="p">()</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">ANA_MSG_FATAL</span><span class="p">(</span><span class="s">&quot;A configured &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">iTrigDecTool_handle</span><span class="p">.</span><span class="n">typeAndName</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; must have been previously created!&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">EL</span><span class="o">::</span><span class="n">StatusCode</span><span class="o">::</span><span class="n">FAILURE</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="n">ANA_CHECK</span><span class="p">(</span><span class="w"> </span><span class="n">iTrigDecTool_handle</span><span class="p">.</span><span class="n">retrieve</span><span class="p">()</span><span class="w"> </span><span class="p">);</span>
<span class="w">      </span><span class="n">ANA_CHECK</span><span class="p">(</span><span class="w"> </span><span class="n">m_pileup_tool_handle</span><span class="p">.</span><span class="n">setProperty</span><span class="p">(</span><span class="s">&quot;TrigDecisionTool&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">iTrigDecTool_handle</span><span class="w"> </span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">ANA_CHECK</span><span class="p">(</span><span class="w"> </span><span class="n">m_pileup_tool_handle</span><span class="p">.</span><span class="n">retrieve</span><span class="p">());</span>
<span class="w">    </span><span class="n">ANA_MSG_DEBUG</span><span class="p">(</span><span class="s">&quot;Retrieved tool: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">m_pileup_tool_handle</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="c1">// As a check, let&#39;s see the number of events in our file (long long int)</span>
<span class="w">  </span><span class="c1">//</span>
<span class="w">  </span><span class="n">ANA_MSG_INFO</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;Number of events in file = &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">m_event</span><span class="o">-&gt;</span><span class="n">getEntries</span><span class="p">());</span>

<span class="w">  </span><span class="c1">// Initialize counter for number of entries</span>
<span class="w">  </span><span class="n">m_eventCounter</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>

<span class="w">  </span><span class="n">ANA_MSG_INFO</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;BasicEventSelection succesfully initialized!&quot;</span><span class="p">);</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">EL</span><span class="o">::</span><span class="n">StatusCode</span><span class="o">::</span><span class="n">SUCCESS</span><span class="p">;</span>
<span class="p">}</span>



<span class="n">EL</span><span class="o">::</span><span class="n">StatusCode</span><span class="w"> </span><span class="n">BasicEventSelection</span><span class="w"> </span><span class="o">::</span><span class="w"> </span><span class="n">execute</span><span class="w"> </span><span class="p">()</span>
<span class="p">{</span>
<span class="w">  </span><span class="c1">// Here you do everything that needs to be done on every single</span>
<span class="w">  </span><span class="c1">// events, e.g. read input variables, apply cuts, and fill</span>
<span class="w">  </span><span class="c1">// histograms and trees.  This is where most of your actual analysis</span>
<span class="w">  </span><span class="c1">// code will go.</span>

<span class="w">  </span><span class="n">ANA_MSG_DEBUG</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;Basic Event Selection&quot;</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// Print every 1000 entries, so we know where we are:</span>
<span class="w">  </span><span class="c1">//</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">m_eventCounter</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">1000</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">ANA_MSG_INFO</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;Entry number = &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">m_eventCounter</span><span class="p">);</span>
<span class="w">    </span><span class="n">ANA_MSG_VERBOSE</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;Store Content:&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">msgLvl</span><span class="p">(</span><span class="n">MSG</span><span class="o">::</span><span class="n">VERBOSE</span><span class="p">))</span><span class="w"> </span><span class="n">m_store</span><span class="o">-&gt;</span><span class="n">print</span><span class="p">();</span>
<span class="w">    </span><span class="n">ANA_MSG_VERBOSE</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;End Content&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="c1">//-----------------------------------------</span>
<span class="w">  </span><span class="c1">// Print triggers used for first entry only</span>
<span class="w">  </span><span class="c1">// and fill the trigger expression for</span>
<span class="w">  </span><span class="c1">// unprescaling data</span>
<span class="w">  </span><span class="c1">//-----------------------------------------</span>

<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">TriggerExpression</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">;</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="n">m_triggerSelection</span><span class="p">.</span><span class="n">empty</span><span class="p">()</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">m_eventCounter</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">m_eventCounter</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="n">ANA_MSG_INFO</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;*** Triggers used (in OR) are:</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">      </span><span class="k">auto</span><span class="w"> </span><span class="n">printingTriggerChainGroup</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_trigDecTool_handle</span><span class="o">-&gt;</span><span class="n">getChainGroup</span><span class="p">(</span><span class="n">m_triggerSelection</span><span class="p">);</span>
<span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">triggersUsed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">printingTriggerChainGroup</span><span class="o">-&gt;</span><span class="n">getListOfTriggers</span><span class="p">();</span>
<span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">iTrigger</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">iTrigger</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">triggersUsed</span><span class="p">.</span><span class="n">size</span><span class="p">();</span><span class="w"> </span><span class="o">++</span><span class="n">iTrigger</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">m_eventCounter</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="n">ANA_MSG_INFO</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">triggersUsed</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">iTrigger</span><span class="p">).</span><span class="n">c_str</span><span class="p">());</span>
<span class="w">        </span><span class="n">TriggerExpression</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">triggersUsed</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">iTrigger</span><span class="p">).</span><span class="n">c_str</span><span class="p">());</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">iTrigger</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">triggersUsed</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="n">TriggerExpression</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot; || &quot;</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">m_eventCounter</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">m_extraTriggerSelection</span><span class="p">.</span><span class="n">empty</span><span class="p">()</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">ANA_MSG_INFO</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;*** Extra Trigger Info Saved are :</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">trigName</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">m_extraTriggerSelectionList</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">ANA_MSG_INFO</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">trigName</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>

<span class="w">      </span><span class="n">ANA_MSG_INFO</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">Evaluates to:&quot;</span><span class="p">);</span>
<span class="w">      </span><span class="k">auto</span><span class="w"> </span><span class="n">printingTriggerChainGroup</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_trigDecTool_handle</span><span class="o">-&gt;</span><span class="n">getChainGroup</span><span class="p">(</span><span class="n">trigName</span><span class="p">);</span>
<span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">triggersUsed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">printingTriggerChainGroup</span><span class="o">-&gt;</span><span class="n">getListOfTriggers</span><span class="p">();</span>
<span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">iTrigger</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">iTrigger</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">triggersUsed</span><span class="p">.</span><span class="n">size</span><span class="p">();</span><span class="w"> </span><span class="o">++</span><span class="n">iTrigger</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">ANA_MSG_INFO</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">- &quot;</span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">triggersUsed</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">iTrigger</span><span class="p">).</span><span class="n">c_str</span><span class="p">());</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>



<span class="w">  </span><span class="o">++</span><span class="n">m_eventCounter</span><span class="p">;</span>

<span class="w">  </span><span class="c1">//------------------</span>
<span class="w">  </span><span class="c1">// Grab event</span>
<span class="w">  </span><span class="c1">//------------------</span>
<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="n">xAOD</span><span class="o">::</span><span class="n">EventInfo</span><span class="o">*</span><span class="w"> </span><span class="nf">eventInfo</span><span class="p">(</span><span class="k">nullptr</span><span class="p">);</span>
<span class="w">  </span><span class="n">ANA_CHECK</span><span class="p">(</span><span class="w"> </span><span class="n">HelperFunctions</span><span class="o">::</span><span class="n">retrieve</span><span class="p">(</span><span class="n">eventInfo</span><span class="p">,</span><span class="w"> </span><span class="n">m_eventInfoContainerName</span><span class="p">,</span><span class="w"> </span><span class="n">m_event</span><span class="p">,</span><span class="w"> </span><span class="n">m_store</span><span class="p">,</span><span class="w"> </span><span class="n">msg</span><span class="p">())</span><span class="w"> </span><span class="p">);</span>

<span class="w">  </span><span class="c1">//------------------------------------------------------------------------------------------</span>
<span class="w">  </span><span class="c1">// Declare an &#39;eventInfo&#39; decorator with the MC event weight</span>
<span class="w">  </span><span class="c1">//------------------------------------------------------------------------------------------</span>
<span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="n">SG</span><span class="o">::</span><span class="n">AuxElement</span><span class="o">::</span><span class="n">Decorator</span><span class="o">&lt;</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">mcEvtWeightDecor</span><span class="p">(</span><span class="s">&quot;mcEventWeight&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="n">SG</span><span class="o">::</span><span class="n">AuxElement</span><span class="o">::</span><span class="n">Accessor</span><span class="o">&lt;</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="o">&gt;</span><span class="w">  </span><span class="n">mcEvtWeightAcc</span><span class="p">(</span><span class="s">&quot;mcEventWeight&quot;</span><span class="p">);</span>

<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="nf">mcEvtWeight</span><span class="p">(</span><span class="mf">1.0</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// Check if need to create xAH event weight</span>
<span class="w">  </span><span class="c1">//</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="n">mcEvtWeightDecor</span><span class="p">.</span><span class="n">isAvailable</span><span class="p">(</span><span class="o">*</span><span class="n">eventInfo</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">isMC</span><span class="p">()</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">weights</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">eventInfo</span><span class="o">-&gt;</span><span class="n">mcEventWeights</span><span class="p">();</span><span class="w"> </span><span class="c1">// The weight (and systs) of all the MC events used in the simulation</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">weights</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">mcEvtWeight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">weights</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>

<span class="w">      </span><span class="c1">//for ( auto&amp; it : weights ) { ANA_MSG_INFO( &quot;event weight: %2f.&quot;, it ); }</span>

<span class="w">      </span><span class="c1">// kill the powheg event with a huge weight</span>
<span class="w">      </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">m_cleanPowheg</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">eventInfo</span><span class="o">-&gt;</span><span class="n">eventNumber</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1652845</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="n">ANA_MSG_INFO</span><span class="p">(</span><span class="s">&quot;Dropping huge weight event. Weight should be 352220000&quot;</span><span class="p">);</span>
<span class="w">          </span><span class="n">ANA_MSG_INFO</span><span class="p">(</span><span class="s">&quot;WEIGHT : &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">mcEvtWeight</span><span class="p">);</span>
<span class="w">          </span><span class="n">wk</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">skipEvent</span><span class="p">();</span>
<span class="w">          </span><span class="k">return</span><span class="w"> </span><span class="n">EL</span><span class="o">::</span><span class="n">StatusCode</span><span class="o">::</span><span class="n">SUCCESS</span><span class="p">;</span><span class="w"> </span><span class="c1">// go to next event</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// Decorate event with the *total* MC event weight</span>
<span class="w">    </span><span class="c1">//</span>
<span class="w">    </span><span class="n">mcEvtWeightDecor</span><span class="p">(</span><span class="o">*</span><span class="n">eventInfo</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mcEvtWeight</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">mcEvtWeight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mcEvtWeightAcc</span><span class="p">(</span><span class="o">*</span><span class="n">eventInfo</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="c1">//------------------------------------------------------------------------------------------</span>
<span class="w">  </span><span class="c1">// Fill cutflows for run-by-run checks on data before cuts</span>
<span class="w">  </span><span class="c1">//------------------------------------------------------------------------------------------</span>
<span class="w">  </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">runNumberForCutflow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">uint32_t</span><span class="p">)</span><span class="w"> </span><span class="n">eventInfo</span><span class="o">-&gt;</span><span class="n">runNumber</span><span class="p">();</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">m_doRunByRunCutflows</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">isMC</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">m_runByrun_beforeCuts</span><span class="o">-&gt;</span><span class="n">Fill</span><span class="p">(</span><span class="n">TString</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="n">runNumberForCutflow</span><span class="p">)),</span><span class="w"> </span><span class="mf">1.</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="c1">//------------------------------------------------------------------------------------------</span>
<span class="w">  </span><span class="c1">// Declare an &#39;eventInfo&#39; decorator with the Sherpa 2.2 reweight to multijet truth</span>
<span class="w">  </span><span class="c1">// https://twiki.cern.ch/twiki/bin/viewauth/AtlasProtected/CentralMC15ProductionList#Sherpa_v2_2_0_V_jets_NJet_reweig</span>
<span class="w">  </span><span class="c1">//------------------------------------------------------------------------------------------</span>

<span class="w">  </span><span class="c1">//if ( m_reweightSherpa22 ){</span>
<span class="w">  </span><span class="c1">//  static SG::AuxElement::Decorator&lt; float &gt; weight_Sherpa22Decor(&quot;weight_Sherpa22&quot;);</span>
<span class="w">  </span><span class="c1">//  // Check if weight needs to be added</span>
<span class="w">  </span><span class="c1">//  if ( !weight_Sherpa22Decor.isAvailable(*eventInfo) ) {</span>

<span class="w">  </span><span class="c1">//    float weight_Sherpa22 = -999.;</span>
<span class="w">  </span><span class="c1">//    weight_Sherpa22 = m_reweightSherpa22_tool_handle-&gt;getWeight();</span>
<span class="w">  </span><span class="c1">//    weight_Sherpa22Decor( *eventInfo ) = weight_Sherpa22;</span>
<span class="w">  </span><span class="c1">//    ANA_MSG_DEBUG(&quot;Setting Sherpa 2.2 reweight to &quot; &lt;&lt; weight_Sherpa22);</span>

<span class="w">  </span><span class="c1">//  } // If not already decorated</span>
<span class="w">  </span><span class="c1">//} // if m_reweightSherpa22</span>


<span class="w">  </span><span class="c1">//------------------------------------------------------------------------------------------</span>
<span class="w">  </span><span class="c1">// Fill initial bin of cutflow</span>
<span class="w">  </span><span class="c1">//------------------------------------------------------------------------------------------</span>

<span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="n">m_useMetaData</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="n">m_cutflowHist</span><span class="w"> </span><span class="o">-&gt;</span><span class="n">Fill</span><span class="p">(</span><span class="w"> </span><span class="n">m_cutflow_all</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">);</span>
<span class="w">      </span><span class="n">m_cutflowHistW</span><span class="o">-&gt;</span><span class="n">Fill</span><span class="p">(</span><span class="w"> </span><span class="n">m_cutflow_all</span><span class="p">,</span><span class="w"> </span><span class="n">mcEvtWeight</span><span class="p">);</span>

<span class="w">      </span><span class="n">m_histEventCount</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Fill</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">      </span><span class="n">m_histEventCount</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Fill</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">      </span><span class="n">m_histEventCount</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Fill</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">mcEvtWeight</span><span class="p">);</span>
<span class="w">      </span><span class="n">m_histEventCount</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Fill</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="n">mcEvtWeight</span><span class="p">);</span>
<span class="w">      </span><span class="n">m_histEventCount</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Fill</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="n">mcEvtWeight</span><span class="o">*</span><span class="n">mcEvtWeight</span><span class="p">);</span>
<span class="w">      </span><span class="n">m_histEventCount</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Fill</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="n">mcEvtWeight</span><span class="o">*</span><span class="n">mcEvtWeight</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">  </span><span class="n">m_cutflowHist</span><span class="w"> </span><span class="o">-&gt;</span><span class="n">Fill</span><span class="p">(</span><span class="w"> </span><span class="n">m_cutflow_init</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">);</span>
<span class="w">  </span><span class="n">m_cutflowHistW</span><span class="o">-&gt;</span><span class="n">Fill</span><span class="p">(</span><span class="w"> </span><span class="n">m_cutflow_init</span><span class="p">,</span><span class="w"> </span><span class="n">mcEvtWeight</span><span class="p">);</span>

<span class="w">  </span><span class="c1">//--------------------------------------------------------------------------------------------------------</span>
<span class="w">  </span><span class="c1">// Check current event is not a duplicate</span>
<span class="w">  </span><span class="c1">// This is done by checking against the std::set of &lt;runNumber,eventNumber&gt; filled for all previous events</span>
<span class="w">  </span><span class="c1">//--------------------------------------------------------------------------------------------------------</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="n">isMC</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">m_checkDuplicatesData</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">isMC</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">m_checkDuplicatesMC</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="n">Long64_t</span><span class="o">&gt;</span><span class="w"> </span><span class="n">thispair</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_pair</span><span class="p">(</span><span class="n">eventInfo</span><span class="o">-&gt;</span><span class="n">runNumber</span><span class="p">(),</span><span class="n">eventInfo</span><span class="o">-&gt;</span><span class="n">eventNumber</span><span class="p">());</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">m_RunNr_VS_EvtNr</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">thispair</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">m_RunNr_VS_EvtNr</span><span class="p">.</span><span class="n">end</span><span class="p">()</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">      </span><span class="n">ANA_MSG_WARNING</span><span class="p">(</span><span class="s">&quot;Found duplicated event! runNumber = &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">eventInfo</span><span class="o">-&gt;</span><span class="n">runNumber</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;, eventNumber = &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">eventInfo</span><span class="o">-&gt;</span><span class="n">eventNumber</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;. Skipping this event&quot;</span><span class="p">);</span>

<span class="w">      </span><span class="c1">// Bookkeep info in duplicates TTree</span>
<span class="w">      </span><span class="c1">//</span>
<span class="w">      </span><span class="n">m_duplRunNumber</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">eventInfo</span><span class="o">-&gt;</span><span class="n">runNumber</span><span class="p">();</span>
<span class="w">      </span><span class="n">m_duplEventNumber</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">eventInfo</span><span class="o">-&gt;</span><span class="n">eventNumber</span><span class="p">();</span>

<span class="w">      </span><span class="n">m_duplicatesTree</span><span class="o">-&gt;</span><span class="n">Fill</span><span class="p">();</span>

<span class="w">      </span><span class="n">wk</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">skipEvent</span><span class="p">();</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="n">EL</span><span class="o">::</span><span class="n">StatusCode</span><span class="o">::</span><span class="n">SUCCESS</span><span class="p">;</span><span class="w"> </span><span class="c1">// go to next event</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">m_RunNr_VS_EvtNr</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">thispair</span><span class="p">);</span>

<span class="w">    </span><span class="n">m_cutflowHist</span><span class="w"> </span><span class="o">-&gt;</span><span class="n">Fill</span><span class="p">(</span><span class="w"> </span><span class="n">m_cutflow_duplicates</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="n">m_cutflowHistW</span><span class="o">-&gt;</span><span class="n">Fill</span><span class="p">(</span><span class="w"> </span><span class="n">m_cutflow_duplicates</span><span class="p">,</span><span class="w"> </span><span class="n">mcEvtWeight</span><span class="p">);</span>

<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="c1">//------------------------------------------------------------------------------------------</span>
<span class="w">  </span><span class="c1">// Update Pile-Up Reweighting</span>
<span class="w">  </span><span class="c1">//------------------------------------------------------------------------------------------</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">m_doPUreweighting</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">m_pileup_tool_handle</span><span class="o">-&gt;</span><span class="n">applySystematicVariation</span><span class="p">(</span><span class="n">CP</span><span class="o">::</span><span class="n">SystematicSet</span><span class="p">()).</span><span class="n">ignore</span><span class="p">();</span>
<span class="w">    </span><span class="n">ANA_CHECK</span><span class="p">(</span><span class="n">m_pileup_tool_handle</span><span class="o">-&gt;</span><span class="n">apply</span><span class="p">(</span><span class="w"> </span><span class="o">*</span><span class="n">eventInfo</span><span class="w"> </span><span class="p">));</span><span class="w"> </span><span class="c1">// NB: this call automatically decorates eventInfo with:</span>
<span class="w">                                                 </span><span class="c1">//  1.) the PU weight (&quot;PileupWeight&quot;)</span>
<span class="w">                                                 </span><span class="c1">//  2.) the corrected mu (&quot;corrected_averageInteractionsPerCrossing&quot;)</span>
<span class="w">                                                 </span><span class="c1">//  3.) the random run number (&quot;RandomRunNumber&quot;)</span>
<span class="w">                                                 </span><span class="c1">//  4.) the random lumiblock number (&quot;RandomLumiBlockNumber&quot;)</span>
<span class="w">    </span><span class="c1">// static SG::AuxElement::Decorator&lt; float &gt;  correctedAvgMu(&quot;corrected_averageInteractionsPerCrossing&quot;);</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="n">SG</span><span class="o">::</span><span class="n">AuxElement</span><span class="o">::</span><span class="n">Decorator</span><span class="o">&lt;</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="o">&gt;</span><span class="w">  </span><span class="n">correctedAndScaledAvgMu</span><span class="p">(</span><span class="s">&quot;correctedScaled_averageInteractionsPerCrossing&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="n">SG</span><span class="o">::</span><span class="n">AuxElement</span><span class="o">::</span><span class="n">Decorator</span><span class="o">&lt;</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="o">&gt;</span><span class="w">  </span><span class="n">correctedMu</span><span class="p">(</span><span class="s">&quot;corrected_actualInteractionsPerCrossing&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="n">SG</span><span class="o">::</span><span class="n">AuxElement</span><span class="o">::</span><span class="n">Decorator</span><span class="o">&lt;</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="o">&gt;</span><span class="w">  </span><span class="n">correctedAndScaledMu</span><span class="p">(</span><span class="s">&quot;correctedScaled_actualInteractionsPerCrossing&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="n">correctedAndScaledAvgMu</span><span class="p">(</span><span class="w"> </span><span class="o">*</span><span class="n">eventInfo</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_pileup_tool_handle</span><span class="o">-&gt;</span><span class="n">getCorrectedAverageInteractionsPerCrossing</span><span class="p">(</span><span class="w"> </span><span class="o">*</span><span class="n">eventInfo</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="n">correctedMu</span><span class="p">(</span><span class="w"> </span><span class="o">*</span><span class="n">eventInfo</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_pileup_tool_handle</span><span class="o">-&gt;</span><span class="n">getCorrectedActualInteractionsPerCrossing</span><span class="p">(</span><span class="w"> </span><span class="o">*</span><span class="n">eventInfo</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="n">correctedAndScaledMu</span><span class="p">(</span><span class="w"> </span><span class="o">*</span><span class="n">eventInfo</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_pileup_tool_handle</span><span class="o">-&gt;</span><span class="n">getCorrectedActualInteractionsPerCrossing</span><span class="p">(</span><span class="w"> </span><span class="o">*</span><span class="n">eventInfo</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="w"> </span><span class="p">);</span>

<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">isMC</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">m_doPUreweightingSys</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">CP</span><span class="o">::</span><span class="n">SystematicSet</span><span class="w"> </span><span class="n">tmpSet</span><span class="p">;</span><span class="n">tmpSet</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">CP</span><span class="o">::</span><span class="n">SystematicVariation</span><span class="p">(</span><span class="s">&quot;PRW_DATASF&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">));</span>
<span class="w">        </span><span class="n">m_pileup_tool_handle</span><span class="o">-&gt;</span><span class="n">applySystematicVariation</span><span class="p">(</span><span class="w"> </span><span class="n">tmpSet</span><span class="w"> </span><span class="p">).</span><span class="n">ignore</span><span class="p">();</span>
<span class="w">    </span><span class="n">eventInfo</span><span class="o">-&gt;</span><span class="n">auxdecor</span><span class="o">&lt;</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="o">&gt;</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;PileupWeight_UP&quot;</span><span class="w"> </span><span class="p">)</span><span class="o">=</span><span class="w"> </span><span class="n">m_pileup_tool_handle</span><span class="o">-&gt;</span><span class="n">getCombinedWeight</span><span class="p">(</span><span class="w"> </span><span class="o">*</span><span class="n">eventInfo</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="n">tmpSet</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span><span class="n">tmpSet</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">CP</span><span class="o">::</span><span class="n">SystematicVariation</span><span class="p">(</span><span class="s">&quot;PRW_DATASF&quot;</span><span class="p">,</span><span class="mi">-1</span><span class="p">));</span>
<span class="w">    </span><span class="n">m_pileup_tool_handle</span><span class="o">-&gt;</span><span class="n">applySystematicVariation</span><span class="p">(</span><span class="w"> </span><span class="n">tmpSet</span><span class="w"> </span><span class="p">).</span><span class="n">ignore</span><span class="p">();</span>
<span class="w">    </span><span class="n">eventInfo</span><span class="o">-&gt;</span><span class="n">auxdecor</span><span class="o">&lt;</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="o">&gt;</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;PileupWeight_DOWN&quot;</span><span class="p">)</span><span class="o">=</span><span class="w"> </span><span class="n">m_pileup_tool_handle</span><span class="o">-&gt;</span><span class="n">getCombinedWeight</span><span class="p">(</span><span class="w"> </span><span class="o">*</span><span class="n">eventInfo</span><span class="w"> </span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">m_actualMuMin</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="c1">// apply minimum pile-up cut</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">eventInfo</span><span class="o">-&gt;</span><span class="n">actualInteractionsPerCrossing</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">m_actualMuMin</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// veto event</span>
<span class="w">          </span><span class="n">wk</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">skipEvent</span><span class="p">();</span>
<span class="w">          </span><span class="k">return</span><span class="w"> </span><span class="n">EL</span><span class="o">::</span><span class="n">StatusCode</span><span class="o">::</span><span class="n">SUCCESS</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">m_actualMuMax</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="c1">// apply maximum pile-up cut</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">eventInfo</span><span class="o">-&gt;</span><span class="n">actualInteractionsPerCrossing</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">m_actualMuMax</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// veto event</span>
<span class="w">          </span><span class="n">wk</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">skipEvent</span><span class="p">();</span>
<span class="w">          </span><span class="k">return</span><span class="w"> </span><span class="n">EL</span><span class="o">::</span><span class="n">StatusCode</span><span class="o">::</span><span class="n">SUCCESS</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>


<span class="w">  </span><span class="c1">//------------------------------------------------------</span>
<span class="w">  </span><span class="c1">// If data, check if event passes GRL and event cleaning</span>
<span class="w">  </span><span class="c1">//------------------------------------------------------</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="n">isMC</span><span class="p">()</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="c1">// Get the streams that the event was put in</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">m_checkStreams</span><span class="p">){</span>
<span class="w">      </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="w">  </span><span class="n">xAOD</span><span class="o">::</span><span class="n">EventInfo</span><span class="o">::</span><span class="n">StreamTag</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">streams</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">eventInfo</span><span class="o">-&gt;</span><span class="n">streamTags</span><span class="p">();</span>

<span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">stream</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">streams</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">ANA_MSG_DEBUG</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;event has fired stream: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">stream</span><span class="p">.</span><span class="n">name</span><span class="p">()</span><span class="w"> </span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// GRL</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">m_applyGRLCut</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="n">m_grl_handle</span><span class="o">-&gt;</span><span class="n">passRunLB</span><span class="p">(</span><span class="w"> </span><span class="o">*</span><span class="n">eventInfo</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">wk</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">skipEvent</span><span class="p">();</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">EL</span><span class="o">::</span><span class="n">StatusCode</span><span class="o">::</span><span class="n">SUCCESS</span><span class="p">;</span><span class="w"> </span><span class="c1">// go to next event</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="n">m_cutflowHist</span><span class="w"> </span><span class="o">-&gt;</span><span class="n">Fill</span><span class="p">(</span><span class="w"> </span><span class="n">m_cutflow_grl</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">);</span>
<span class="w">      </span><span class="n">m_cutflowHistW</span><span class="o">-&gt;</span><span class="n">Fill</span><span class="p">(</span><span class="w"> </span><span class="n">m_cutflow_grl</span><span class="p">,</span><span class="w"> </span><span class="n">mcEvtWeight</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">//------------------------------------------------------------</span>
<span class="w">    </span><span class="c1">// Apply event cleaning to remove events due to</span>
<span class="w">    </span><span class="c1">// problematic regions of the detector, and incomplete events.</span>
<span class="w">    </span><span class="c1">// Apply to data.</span>
<span class="w">    </span><span class="c1">//------------------------------------------------------------</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">m_applyEventCleaningCut</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">eventInfo</span><span class="o">-&gt;</span><span class="n">errorState</span><span class="p">(</span><span class="n">xAOD</span><span class="o">::</span><span class="n">EventInfo</span><span class="o">::</span><span class="n">LAr</span><span class="p">)</span><span class="o">==</span><span class="n">xAOD</span><span class="o">::</span><span class="n">EventInfo</span><span class="o">::</span><span class="n">Error</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">wk</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">skipEvent</span><span class="p">();</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="n">EL</span><span class="o">::</span><span class="n">StatusCode</span><span class="o">::</span><span class="n">SUCCESS</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">m_cutflowHist</span><span class="w"> </span><span class="o">-&gt;</span><span class="n">Fill</span><span class="p">(</span><span class="w"> </span><span class="n">m_cutflow_lar</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="n">m_cutflowHistW</span><span class="o">-&gt;</span><span class="n">Fill</span><span class="p">(</span><span class="w"> </span><span class="n">m_cutflow_lar</span><span class="p">,</span><span class="w"> </span><span class="n">mcEvtWeight</span><span class="p">);</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">m_applyEventCleaningCut</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">eventInfo</span><span class="o">-&gt;</span><span class="n">errorState</span><span class="p">(</span><span class="n">xAOD</span><span class="o">::</span><span class="n">EventInfo</span><span class="o">::</span><span class="n">Tile</span><span class="p">)</span><span class="o">==</span><span class="n">xAOD</span><span class="o">::</span><span class="n">EventInfo</span><span class="o">::</span><span class="n">Error</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">wk</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">skipEvent</span><span class="p">();</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="n">EL</span><span class="o">::</span><span class="n">StatusCode</span><span class="o">::</span><span class="n">SUCCESS</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">m_cutflowHist</span><span class="w"> </span><span class="o">-&gt;</span><span class="n">Fill</span><span class="p">(</span><span class="w"> </span><span class="n">m_cutflow_tile</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="n">m_cutflowHistW</span><span class="o">-&gt;</span><span class="n">Fill</span><span class="p">(</span><span class="w"> </span><span class="n">m_cutflow_tile</span><span class="p">,</span><span class="w"> </span><span class="n">mcEvtWeight</span><span class="p">);</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">m_applyEventCleaningCut</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">eventInfo</span><span class="o">-&gt;</span><span class="n">errorState</span><span class="p">(</span><span class="n">xAOD</span><span class="o">::</span><span class="n">EventInfo</span><span class="o">::</span><span class="n">SCT</span><span class="p">)</span><span class="o">==</span><span class="n">xAOD</span><span class="o">::</span><span class="n">EventInfo</span><span class="o">::</span><span class="n">Error</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">wk</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">skipEvent</span><span class="p">();</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="n">EL</span><span class="o">::</span><span class="n">StatusCode</span><span class="o">::</span><span class="n">SUCCESS</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">m_cutflowHist</span><span class="w"> </span><span class="o">-&gt;</span><span class="n">Fill</span><span class="p">(</span><span class="w"> </span><span class="n">m_cutflow_SCT</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="n">m_cutflowHistW</span><span class="o">-&gt;</span><span class="n">Fill</span><span class="p">(</span><span class="w"> </span><span class="n">m_cutflow_SCT</span><span class="p">,</span><span class="w"> </span><span class="n">mcEvtWeight</span><span class="p">);</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">m_applyCoreFlagsCut</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">eventInfo</span><span class="o">-&gt;</span><span class="n">isEventFlagBitSet</span><span class="p">(</span><span class="n">xAOD</span><span class="o">::</span><span class="n">EventInfo</span><span class="o">::</span><span class="n">Core</span><span class="p">,</span><span class="w"> </span><span class="mi">18</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">wk</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">skipEvent</span><span class="p">();</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="n">EL</span><span class="o">::</span><span class="n">StatusCode</span><span class="o">::</span><span class="n">SUCCESS</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">m_cutflowHist</span><span class="w"> </span><span class="o">-&gt;</span><span class="n">Fill</span><span class="p">(</span><span class="w"> </span><span class="n">m_cutflow_core</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="n">m_cutflowHistW</span><span class="o">-&gt;</span><span class="n">Fill</span><span class="p">(</span><span class="w"> </span><span class="n">m_cutflow_core</span><span class="p">,</span><span class="w"> </span><span class="n">mcEvtWeight</span><span class="p">);</span>

<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="c1">// more info: https://twiki.cern.ch/twiki/bin/viewauth/AtlasProtected/HowToCleanJets2017</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">m_applyJetCleaningEventFlag</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">eventInfo</span><span class="o">-&gt;</span><span class="n">isAvailable</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;DFCommonJets_eventClean_LooseBad&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">eventInfo</span><span class="o">-&gt;</span><span class="n">auxdataConst</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;DFCommonJets_eventClean_LooseBad&quot;</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">wk</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">skipEvent</span><span class="p">();</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">EL</span><span class="o">::</span><span class="n">StatusCode</span><span class="o">::</span><span class="n">SUCCESS</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="n">m_cutflowHist</span><span class="w"> </span><span class="o">-&gt;</span><span class="n">Fill</span><span class="p">(</span><span class="w"> </span><span class="n">m_cutflow_jetcleaning</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">);</span>
<span class="w">  </span><span class="n">m_cutflowHistW</span><span class="o">-&gt;</span><span class="n">Fill</span><span class="p">(</span><span class="w"> </span><span class="n">m_cutflow_jetcleaning</span><span class="p">,</span><span class="w"> </span><span class="n">mcEvtWeight</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// n.b. this cut should only be applied in 2015+16 data, and not to MC!</span>
<span class="w">  </span><span class="c1">// details here: https://twiki.cern.ch/twiki/bin/viewauth/AtlasProtected/HowToCleanJets2017#IsBadBatMan_Event_Flag_and_EMEC</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">m_applyIsBadBatmanFlag</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">eventInfo</span><span class="o">-&gt;</span><span class="n">isAvailable</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;DFCommonJets_isBadBatman&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w">  </span><span class="o">!</span><span class="n">isMC</span><span class="p">()</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">eventInfo</span><span class="o">-&gt;</span><span class="n">auxdataConst</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;DFCommonJets_isBadBatman&quot;</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">wk</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">skipEvent</span><span class="p">();</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="n">EL</span><span class="o">::</span><span class="n">StatusCode</span><span class="o">::</span><span class="n">SUCCESS</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="n">m_cutflowHist</span><span class="w"> </span><span class="o">-&gt;</span><span class="n">Fill</span><span class="p">(</span><span class="w"> </span><span class="n">m_cutflow_isbadbatman</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">);</span>
<span class="w">  </span><span class="n">m_cutflowHistW</span><span class="o">-&gt;</span><span class="n">Fill</span><span class="p">(</span><span class="w"> </span><span class="n">m_cutflow_isbadbatman</span><span class="p">,</span><span class="w"> </span><span class="n">mcEvtWeight</span><span class="p">);</span>

<span class="w">  </span><span class="c1">//-----------------------------</span>
<span class="w">  </span><span class="c1">// Primary Vertex &#39;quality&#39; cut</span>
<span class="w">  </span><span class="c1">//-----------------------------</span>

<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="n">xAOD</span><span class="o">::</span><span class="n">VertexContainer</span><span class="o">*</span><span class="w"> </span><span class="nf">vertices</span><span class="p">(</span><span class="k">nullptr</span><span class="p">);</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="n">m_truthLevelOnly</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">m_applyPrimaryVertexCut</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">ANA_CHECK</span><span class="p">(</span><span class="w"> </span><span class="n">HelperFunctions</span><span class="o">::</span><span class="n">retrieve</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span><span class="w"> </span><span class="n">m_vertexContainerName</span><span class="p">,</span><span class="w"> </span><span class="n">m_event</span><span class="p">,</span><span class="w"> </span><span class="n">m_store</span><span class="p">,</span><span class="w"> </span><span class="n">msg</span><span class="p">())</span><span class="w"> </span><span class="p">);</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="n">HelperFunctions</span><span class="o">::</span><span class="n">passPrimaryVertexSelection</span><span class="p">(</span><span class="w"> </span><span class="n">vertices</span><span class="p">,</span><span class="w"> </span><span class="n">m_PVNTrack</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">wk</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">skipEvent</span><span class="p">();</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="n">EL</span><span class="o">::</span><span class="n">StatusCode</span><span class="o">::</span><span class="n">SUCCESS</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="n">m_cutflowHist</span><span class="w"> </span><span class="o">-&gt;</span><span class="n">Fill</span><span class="p">(</span><span class="w"> </span><span class="n">m_cutflow_npv</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">);</span>
<span class="w">  </span><span class="n">m_cutflowHistW</span><span class="o">-&gt;</span><span class="n">Fill</span><span class="p">(</span><span class="w"> </span><span class="n">m_cutflow_npv</span><span class="p">,</span><span class="w"> </span><span class="n">mcEvtWeight</span><span class="p">);</span>

<span class="w">  </span><span class="c1">//---------------------</span>
<span class="w">  </span><span class="c1">// Trigger decision cut</span>
<span class="w">  </span><span class="c1">//---------------------</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="n">m_triggerSelection</span><span class="p">.</span><span class="n">empty</span><span class="p">()</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">m_storeTrigDecisions</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">triggerChainGroup</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_trigDecTool_handle</span><span class="o">-&gt;</span><span class="n">getChainGroup</span><span class="p">(</span><span class="n">m_triggerSelection</span><span class="p">);</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">m_applyTriggerCut</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">      </span><span class="c1">// additional DEBUG logging to validate conditional logic</span>
<span class="w">      </span><span class="n">ANA_MSG_DEBUG</span><span class="p">(</span><span class="s">&quot;Applying trigger cut corresponding to chain group &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">m_triggerSelection</span><span class="p">);</span>
<span class="w">      </span><span class="n">ANA_MSG_DEBUG</span><span class="p">(</span><span class="s">&quot;Is Trigger-Level Analysis (TLA) data = &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="kt">int</span><span class="p">(</span><span class="n">m_isTLAData</span><span class="p">));</span>
<span class="w">      </span><span class="n">ANA_MSG_DEBUG</span><span class="p">(</span><span class="s">&quot;Trigger chain group is passed = &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="kt">int</span><span class="p">(</span><span class="n">m_isTLAData</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">triggerChainGroup</span><span class="o">-&gt;</span><span class="n">isPassed</span><span class="p">(</span><span class="n">TrigDefs</span><span class="o">::</span><span class="n">requireDecision</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">triggerChainGroup</span><span class="o">-&gt;</span><span class="n">isPassed</span><span class="p">()));</span>

<span class="w">      </span><span class="c1">// different behaviour for isPassed depending on whether you are running on TLA data or not</span>
<span class="w">      </span><span class="c1">// if running on TLA data, we only store the HLT part of the trigger decision i.e. the L1 part</span>
<span class="w">      </span><span class="c1">// will always be &quot;false&quot;, so we need to use TrigDefs::requireDecision to limit the decision</span>
<span class="w">      </span><span class="c1">// to being satisfied by the HLT leg(s) of the trigger chain</span>
<span class="w">      </span><span class="c1">// TODO: check performance of this method when using trigger chains with the SAME HLT leg but different L1 seed</span>
<span class="w">      </span><span class="c1">// e.g. HLT_j20_pf_ftf_L1J100 vs. HLT_j20_pf_ftf_L1HT190-J15s5pETA21</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">m_isTLAData</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">triggerChainGroup</span><span class="o">-&gt;</span><span class="n">isPassed</span><span class="p">(</span><span class="n">TrigDefs</span><span class="o">::</span><span class="n">requireDecision</span><span class="p">))</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">m_isTLAData</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">triggerChainGroup</span><span class="o">-&gt;</span><span class="n">isPassed</span><span class="p">())</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="c1">// if (!triggerChainGroup-&gt;isPassed(TrigDefs::requireDecision)) {</span>
<span class="w">        </span><span class="n">wk</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">skipEvent</span><span class="p">();</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">EL</span><span class="o">::</span><span class="n">StatusCode</span><span class="o">::</span><span class="n">SUCCESS</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="n">m_cutflowHist</span><span class="w"> </span><span class="o">-&gt;</span><span class="n">Fill</span><span class="p">(</span><span class="w"> </span><span class="n">m_cutflow_trigger</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">);</span>
<span class="w">      </span><span class="n">m_cutflowHistW</span><span class="o">-&gt;</span><span class="n">Fill</span><span class="p">(</span><span class="w"> </span><span class="n">m_cutflow_trigger</span><span class="p">,</span><span class="w"> </span><span class="n">mcEvtWeight</span><span class="p">);</span>

<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// save passed triggers in eventInfo</span>
<span class="w">    </span><span class="c1">//</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">m_storeTrigDecisions</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="w">  </span><span class="n">passedTriggers</span><span class="p">;</span>
<span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="w">  </span><span class="n">disabledTriggers</span><span class="p">;</span>
<span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="w">        </span><span class="n">triggerPrescales</span><span class="p">;</span>
<span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="w">        </span><span class="n">triggerPrescalesLumi</span><span class="p">;</span>
<span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="w">  </span><span class="n">isPassedBitsNames</span><span class="p">;</span>
<span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">isPassedBits</span><span class="p">;</span>

<span class="w">      </span><span class="c1">// Save info for the triggers used to skim events</span>
<span class="w">      </span><span class="c1">//</span>
<span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">trigName</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">triggerChainGroup</span><span class="o">-&gt;</span><span class="n">getListOfTriggers</span><span class="p">()</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">auto</span><span class="w"> </span><span class="n">trigChain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_trigDecTool_handle</span><span class="o">-&gt;</span><span class="n">getChainGroup</span><span class="p">(</span><span class="w"> </span><span class="n">trigName</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">m_isTLAData</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">trigChain</span><span class="o">-&gt;</span><span class="n">isPassed</span><span class="p">(</span><span class="n">TrigDefs</span><span class="o">::</span><span class="n">requireDecision</span><span class="p">))</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">m_isTLAData</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">trigChain</span><span class="o">-&gt;</span><span class="n">isPassed</span><span class="p">())</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="n">passedTriggers</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="w"> </span><span class="n">trigName</span><span class="w"> </span><span class="p">);</span>
<span class="w">          </span><span class="n">triggerPrescales</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="w"> </span><span class="n">trigChain</span><span class="o">-&gt;</span><span class="n">getPrescale</span><span class="p">()</span><span class="w"> </span><span class="p">);</span>

<span class="w">          </span><span class="kt">bool</span><span class="w"> </span><span class="n">doLumiPrescale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">find</span><span class="p">(</span><span class="n">m_triggerUnprescaleList</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span><span class="w"> </span><span class="n">m_triggerUnprescaleList</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span><span class="w"> </span><span class="n">trigName</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">m_triggerUnprescaleList</span><span class="p">.</span><span class="n">end</span><span class="p">();</span>
<span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">doLumiPrescale</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">triggerPrescalesLumi</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="w"> </span><span class="n">m_pileup_tool_handle</span><span class="o">-&gt;</span><span class="n">getDataWeight</span><span class="p">(</span><span class="w"> </span><span class="o">*</span><span class="n">eventInfo</span><span class="p">,</span><span class="w"> </span><span class="n">trigName</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">);</span>
<span class="w">          </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">triggerPrescalesLumi</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="w"> </span><span class="mi">-1</span><span class="w"> </span><span class="p">);</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">isPassedBitsNames</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="w"> </span><span class="n">trigName</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="n">isPassedBits</span><span class="w">     </span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="w"> </span><span class="n">m_trigDecTool_handle</span><span class="o">-&gt;</span><span class="n">isPassedBits</span><span class="p">(</span><span class="n">trigName</span><span class="p">)</span><span class="w"> </span><span class="p">);</span>
<span class="w">          </span><span class="k">if</span><span class="p">(</span><span class="n">trigChain</span><span class="o">-&gt;</span><span class="n">getPrescale</span><span class="p">()</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="n">disabledTriggers</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="w"> </span><span class="n">trigName</span><span class="w"> </span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>

<span class="w">      </span><span class="c1">// Save info for extra triggers</span>
<span class="w">      </span><span class="c1">//</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="n">m_extraTriggerSelection</span><span class="p">.</span><span class="n">empty</span><span class="p">()</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">trigName</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">m_extraTriggerSelectionList</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="k">auto</span><span class="w"> </span><span class="n">trigChain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_trigDecTool_handle</span><span class="o">-&gt;</span><span class="n">getChainGroup</span><span class="p">(</span><span class="w"> </span><span class="n">trigName</span><span class="w"> </span><span class="p">);</span>
<span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">m_isTLAData</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">trigChain</span><span class="o">-&gt;</span><span class="n">isPassed</span><span class="p">(</span><span class="n">TrigDefs</span><span class="o">::</span><span class="n">requireDecision</span><span class="p">))</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">m_isTLAData</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">trigChain</span><span class="o">-&gt;</span><span class="n">isPassed</span><span class="p">())</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">passedTriggers</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="w"> </span><span class="n">trigName</span><span class="w"> </span><span class="p">);</span>
<span class="w">            </span><span class="n">triggerPrescales</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="w"> </span><span class="n">trigChain</span><span class="o">-&gt;</span><span class="n">getPrescale</span><span class="p">()</span><span class="w"> </span><span class="p">);</span>

<span class="w">            </span><span class="kt">bool</span><span class="w"> </span><span class="n">doLumiPrescale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">trigPart</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">trigChain</span><span class="o">-&gt;</span><span class="n">getListOfTriggers</span><span class="p">()</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">              </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">find</span><span class="p">(</span><span class="n">m_triggerUnprescaleList</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span><span class="w"> </span><span class="n">m_triggerUnprescaleList</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span><span class="w"> </span><span class="n">trigPart</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">m_triggerUnprescaleList</span><span class="p">.</span><span class="n">end</span><span class="p">())</span><span class="w"> </span><span class="n">doLumiPrescale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">doLumiPrescale</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">              </span><span class="n">triggerPrescalesLumi</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="w"> </span><span class="n">m_pileup_tool_handle</span><span class="o">-&gt;</span><span class="n">getDataWeight</span><span class="p">(</span><span class="w"> </span><span class="o">*</span><span class="n">eventInfo</span><span class="p">,</span><span class="w"> </span><span class="n">trigName</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">              </span><span class="n">triggerPrescalesLumi</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="w"> </span><span class="mi">-1</span><span class="w"> </span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">          </span><span class="p">}</span>

<span class="w">          </span><span class="n">isPassedBitsNames</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="w"> </span><span class="n">trigName</span><span class="w"> </span><span class="p">);</span>
<span class="w">          </span><span class="n">isPassedBits</span><span class="w">     </span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="w"> </span><span class="n">m_trigDecTool_handle</span><span class="o">-&gt;</span><span class="n">isPassedBits</span><span class="p">(</span><span class="n">trigName</span><span class="p">)</span><span class="w"> </span><span class="p">);</span>
<span class="w">          </span><span class="k">if</span><span class="p">(</span><span class="n">trigChain</span><span class="o">-&gt;</span><span class="n">getPrescale</span><span class="p">()</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="n">disabledTriggers</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="w"> </span><span class="n">trigName</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>

<span class="w">      </span><span class="k">static</span><span class="w"> </span><span class="n">SG</span><span class="o">::</span><span class="n">AuxElement</span><span class="o">::</span><span class="n">Decorator</span><span class="o">&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="o">&gt;</span><span class="w">  </span><span class="n">dec_passedTriggers</span><span class="p">(</span><span class="s">&quot;passedTriggers&quot;</span><span class="p">);</span>
<span class="w">      </span><span class="n">dec_passedTriggers</span><span class="w">  </span><span class="p">(</span><span class="w"> </span><span class="o">*</span><span class="n">eventInfo</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">passedTriggers</span><span class="p">;</span>
<span class="w">      </span><span class="k">static</span><span class="w"> </span><span class="n">SG</span><span class="o">::</span><span class="n">AuxElement</span><span class="o">::</span><span class="n">Decorator</span><span class="o">&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="o">&gt;</span><span class="w">  </span><span class="n">dec_disabledTriggers</span><span class="p">(</span><span class="s">&quot;disabledTriggers&quot;</span><span class="p">);</span>
<span class="w">      </span><span class="n">dec_disabledTriggers</span><span class="p">(</span><span class="w"> </span><span class="o">*</span><span class="n">eventInfo</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">disabledTriggers</span><span class="p">;</span>
<span class="w">      </span><span class="k">static</span><span class="w"> </span><span class="n">SG</span><span class="o">::</span><span class="n">AuxElement</span><span class="o">::</span><span class="n">Decorator</span><span class="o">&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="o">&gt;</span><span class="w">        </span><span class="n">dec_triggerPrescales</span><span class="p">(</span><span class="s">&quot;triggerPrescales&quot;</span><span class="p">);</span>
<span class="w">      </span><span class="n">dec_triggerPrescales</span><span class="p">(</span><span class="w"> </span><span class="o">*</span><span class="n">eventInfo</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">triggerPrescales</span><span class="p">;</span>
<span class="w">      </span><span class="k">static</span><span class="w"> </span><span class="n">SG</span><span class="o">::</span><span class="n">AuxElement</span><span class="o">::</span><span class="n">Decorator</span><span class="o">&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="o">&gt;</span><span class="w">        </span><span class="n">dec_triggerPrescalesLumi</span><span class="p">(</span><span class="s">&quot;triggerPrescalesLumi&quot;</span><span class="p">);</span>
<span class="w">      </span><span class="n">dec_triggerPrescalesLumi</span><span class="p">(</span><span class="w"> </span><span class="o">*</span><span class="n">eventInfo</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">triggerPrescalesLumi</span><span class="p">;</span>
<span class="w">      </span><span class="k">static</span><span class="w"> </span><span class="n">SG</span><span class="o">::</span><span class="n">AuxElement</span><span class="o">::</span><span class="n">Decorator</span><span class="o">&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">dec_isPassedBits</span><span class="p">(</span><span class="s">&quot;isPassedBits&quot;</span><span class="p">);</span>
<span class="w">      </span><span class="n">dec_isPassedBits</span><span class="p">(</span><span class="w"> </span><span class="o">*</span><span class="n">eventInfo</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">isPassedBits</span><span class="p">;</span>
<span class="w">      </span><span class="k">static</span><span class="w"> </span><span class="n">SG</span><span class="o">::</span><span class="n">AuxElement</span><span class="o">::</span><span class="n">Decorator</span><span class="o">&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="o">&gt;</span><span class="w">  </span><span class="n">dec_isPassedBitsNames</span><span class="p">(</span><span class="s">&quot;isPassedBitsNames&quot;</span><span class="p">);</span>
<span class="w">      </span><span class="n">dec_isPassedBitsNames</span><span class="p">(</span><span class="w"> </span><span class="o">*</span><span class="n">eventInfo</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">isPassedBitsNames</span><span class="p">;</span>

<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">m_storePrescaleWeight</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">static</span><span class="w"> </span><span class="n">SG</span><span class="o">::</span><span class="n">AuxElement</span><span class="o">::</span><span class="n">Decorator</span><span class="o">&lt;</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">weight_prescale</span><span class="p">(</span><span class="s">&quot;weight_prescale&quot;</span><span class="p">);</span>
<span class="w">      </span><span class="n">weight_prescale</span><span class="p">(</span><span class="o">*</span><span class="n">eventInfo</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">triggerChainGroup</span><span class="o">-&gt;</span><span class="n">getPrescale</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">m_storePassL1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">static</span><span class="w"> </span><span class="n">SG</span><span class="o">::</span><span class="n">AuxElement</span><span class="o">::</span><span class="n">Decorator</span><span class="o">&lt;</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">passL1</span><span class="p">(</span><span class="s">&quot;passL1&quot;</span><span class="p">);</span>
<span class="w">      </span><span class="n">passL1</span><span class="p">(</span><span class="o">*</span><span class="n">eventInfo</span><span class="p">)</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">m_triggerSelection</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="s">&quot;L1_&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">::</span><span class="n">npos</span><span class="w"> </span><span class="p">)</span><span class="w">  </span><span class="o">?</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">m_trigDecTool_handle</span><span class="o">-&gt;</span><span class="n">isPassed</span><span class="p">(</span><span class="n">m_triggerSelection</span><span class="p">.</span><span class="n">c_str</span><span class="p">())</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">m_storePassHLT</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">static</span><span class="w"> </span><span class="n">SG</span><span class="o">::</span><span class="n">AuxElement</span><span class="o">::</span><span class="n">Decorator</span><span class="o">&lt;</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">passHLT</span><span class="p">(</span><span class="s">&quot;passHLT&quot;</span><span class="p">);</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">m_isTLAData</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">passHLT</span><span class="p">(</span><span class="o">*</span><span class="n">eventInfo</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">m_triggerSelection</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="s">&quot;HLT_&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">::</span><span class="n">npos</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">m_trigDecTool_handle</span><span class="o">-&gt;</span><span class="n">isPassed</span><span class="p">(</span><span class="n">m_triggerSelection</span><span class="p">.</span><span class="n">c_str</span><span class="p">())</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">passHLT</span><span class="p">(</span><span class="o">*</span><span class="n">eventInfo</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">m_triggerSelection</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="s">&quot;HLT_&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">::</span><span class="n">npos</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">m_trigDecTool_handle</span><span class="o">-&gt;</span><span class="n">isPassed</span><span class="p">(</span><span class="n">m_triggerSelection</span><span class="p">.</span><span class="n">c_str</span><span class="p">(),</span><span class="w"> </span><span class="n">TrigDefs</span><span class="o">::</span><span class="n">requireDecision</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="c1">// if giving a specific list of triggers to look at</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">m_storeTrigKeys</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="n">SG</span><span class="o">::</span><span class="n">AuxElement</span><span class="o">::</span><span class="n">Decorator</span><span class="o">&lt;</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">masterKey</span><span class="p">(</span><span class="s">&quot;masterKey&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">masterKey</span><span class="p">(</span><span class="o">*</span><span class="n">eventInfo</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_trigConfTool_handle</span><span class="o">-&gt;</span><span class="n">masterKey</span><span class="p">();</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="n">SG</span><span class="o">::</span><span class="n">AuxElement</span><span class="o">::</span><span class="n">Decorator</span><span class="o">&lt;</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">L1PSKey</span><span class="p">(</span><span class="s">&quot;L1PSKey&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">L1PSKey</span><span class="p">(</span><span class="o">*</span><span class="n">eventInfo</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_trigConfTool_handle</span><span class="o">-&gt;</span><span class="n">lvl1PrescaleKey</span><span class="p">();</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="n">SG</span><span class="o">::</span><span class="n">AuxElement</span><span class="o">::</span><span class="n">Decorator</span><span class="o">&lt;</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">HLTPSKey</span><span class="p">(</span><span class="s">&quot;HLTPSKey&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">HLTPSKey</span><span class="p">(</span><span class="o">*</span><span class="n">eventInfo</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_trigConfTool_handle</span><span class="o">-&gt;</span><span class="n">hltPrescaleKey</span><span class="p">();</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="c1">// Calculate distance to previous empty BCID and previous unpaired BCID, and save as decorations</span>
<span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">m_calcBCIDInfo</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">isMC</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">m_trigConfTool_handle</span><span class="p">.</span><span class="n">isInitialized</span><span class="p">()</span><span class="w"> </span><span class="p">){</span>
<span class="w">    </span><span class="c1">//Distance to previous empty BCID</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">eventInfo</span><span class="o">-&gt;</span><span class="n">bcid</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">--</span><span class="p">){</span>
<span class="w">      </span><span class="c1">//get the bunch group pattern for bunch crossing i</span>
<span class="w">      </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">bgPattern</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_trigConfTool_handle</span><span class="o">-&gt;</span><span class="n">bunchGroupSet</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">bgPattern</span><span class="p">()[</span><span class="n">i</span><span class="p">];</span>
<span class="w">      </span><span class="kt">bool</span><span class="w"> </span><span class="n">isEmpty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">bgPattern</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0x1</span><span class="p">;</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">isEmpty</span><span class="p">){</span>
<span class="w">        </span><span class="k">static</span><span class="w"> </span><span class="n">SG</span><span class="o">::</span><span class="n">AuxElement</span><span class="o">::</span><span class="n">Decorator</span><span class="o">&lt;</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">DistEmptyBCID</span><span class="p">(</span><span class="s">&quot;DistEmptyBCID&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">DistEmptyBCID</span><span class="p">(</span><span class="o">*</span><span class="n">eventInfo</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">eventInfo</span><span class="o">-&gt;</span><span class="n">bcid</span><span class="p">()</span><span class="o">-</span><span class="n">i</span><span class="p">;</span>
<span class="w">        </span><span class="k">break</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span><span class="c1">//for each bcid</span>
<span class="w">    </span><span class="c1">//Distance to previous unpaired crossing</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">eventInfo</span><span class="o">-&gt;</span><span class="n">bcid</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">--</span><span class="p">){</span>
<span class="w">      </span><span class="c1">//get the bunch group pattern for bunch crossing i</span>
<span class="w">      </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">bgPattern</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_trigConfTool_handle</span><span class="o">-&gt;</span><span class="n">bunchGroupSet</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">bgPattern</span><span class="p">()[</span><span class="n">i</span><span class="p">];</span>
<span class="w">      </span><span class="kt">bool</span><span class="w"> </span><span class="n">isUnpaired</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">!</span><span class="p">((</span><span class="n">bgPattern</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0x1</span><span class="p">);</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">isUnpaired</span><span class="p">){</span>
<span class="w">        </span><span class="k">static</span><span class="w"> </span><span class="n">SG</span><span class="o">::</span><span class="n">AuxElement</span><span class="o">::</span><span class="n">Decorator</span><span class="o">&lt;</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">DistLastUnpairedBCID</span><span class="p">(</span><span class="s">&quot;DistLastUnpairedBCID&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">DistLastUnpairedBCID</span><span class="p">(</span><span class="o">*</span><span class="n">eventInfo</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">eventInfo</span><span class="o">-&gt;</span><span class="n">bcid</span><span class="p">()</span><span class="o">-</span><span class="n">i</span><span class="p">;</span>
<span class="w">        </span><span class="k">break</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span><span class="c1">//for each bcid</span>
<span class="w">    </span><span class="c1">//Distance to next unpaired crossing</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">eventInfo</span><span class="o">-&gt;</span><span class="n">bcid</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">3654</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
<span class="w">      </span><span class="c1">//get the bunch group pattern for bunch crossing i</span>
<span class="w">      </span><span class="kt">uint16_t</span><span class="w"> </span><span class="n">bgPattern</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_trigConfTool_handle</span><span class="o">-&gt;</span><span class="n">bunchGroupSet</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">bgPattern</span><span class="p">()[</span><span class="n">i</span><span class="p">];</span>
<span class="w">      </span><span class="kt">bool</span><span class="w"> </span><span class="n">isUnpaired</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">!</span><span class="p">((</span><span class="n">bgPattern</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0x1</span><span class="p">);</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">isUnpaired</span><span class="p">){</span>
<span class="w">        </span><span class="k">static</span><span class="w"> </span><span class="n">SG</span><span class="o">::</span><span class="n">AuxElement</span><span class="o">::</span><span class="n">Decorator</span><span class="o">&lt;</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">DistNextUnpairedBCID</span><span class="p">(</span><span class="s">&quot;DistNextUnpairedBCID&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">DistNextUnpairedBCID</span><span class="p">(</span><span class="o">*</span><span class="n">eventInfo</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="o">-</span><span class="n">eventInfo</span><span class="o">-&gt;</span><span class="n">bcid</span><span class="p">();</span>
<span class="w">        </span><span class="k">break</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span><span class="c1">//  for each bcid</span>

<span class="w">  </span><span class="p">}</span><span class="c1">//if data</span>

<span class="w">  </span><span class="c1">//------------------------------------------------------------------------------------------</span>
<span class="w">  </span><span class="c1">// Fill cutflows for run-by-run checks on data after cuts</span>
<span class="w">  </span><span class="c1">//------------------------------------------------------------------------------------------</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">m_doRunByRunCutflows</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">isMC</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">m_runByrun_afterCuts</span><span class="o">-&gt;</span><span class="n">Fill</span><span class="p">(</span><span class="n">TString</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="n">runNumberForCutflow</span><span class="p">)),</span><span class="w"> </span><span class="mf">1.</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">EL</span><span class="o">::</span><span class="n">StatusCode</span><span class="o">::</span><span class="n">SUCCESS</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// &quot;Borrowed&quot; from SUSYTools</span>
<span class="c1">// https://gitlab.cern.ch/atlas/athena/blob/3be30397de7c6cfdc15de38f532fdb4b9f338297/PhysicsAnalysis/SUSYPhys/SUSYTools/Root/SUSYObjDef_xAOD.cxx#L700</span>
<span class="c1">// Should track official https://gitlab.cern.ch/atlas/athena/-/blob/d09ebd5c011b654159e25ec3e205c09ac1bc64de/PhysicsAnalysis/AnalysisCommon/PileupReweighting/python/AutoconfigurePRW.py</span>
<span class="n">StatusCode</span><span class="w"> </span><span class="n">BasicEventSelection</span><span class="o">::</span><span class="n">autoconfigurePileupRWTool</span><span class="p">()</span>
<span class="p">{</span>

<span class="w">  </span><span class="c1">// Don&#39;t do this if we aren&#39;t supposed to</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="w"> </span><span class="p">(</span><span class="n">isMC</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">m_autoconfigPRW</span><span class="w"> </span><span class="p">))</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">StatusCode</span><span class="o">::</span><span class="n">SUCCESS</span><span class="p">;</span>

<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="n">xAOD</span><span class="o">::</span><span class="n">EventInfo</span><span class="o">*</span><span class="w"> </span><span class="n">eventInfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">  </span><span class="n">ANA_CHECK</span><span class="p">(</span><span class="w"> </span><span class="n">m_event</span><span class="o">-&gt;</span><span class="n">retrieve</span><span class="p">(</span><span class="w"> </span><span class="n">eventInfo</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;EventInfo&quot;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">);</span>

<span class="w">  </span><span class="c1">// Determine simulation flavour</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">SimulationFlavour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">isFastSim</span><span class="p">()</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">isAF3</span><span class="p">()</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s">&quot;AF3&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s">&quot;AFII&quot;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s">&quot;FS&quot;</span><span class="p">;</span>

<span class="w">  </span><span class="c1">// Extract campaign automatically from Run Number</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">mcCampaignMD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">;</span>

<span class="w">  </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">runNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">eventInfo</span><span class="o">-&gt;</span><span class="n">runNumber</span><span class="p">();</span>

<span class="w">  </span><span class="k">switch</span><span class="p">(</span><span class="n">runNum</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="mi">284500</span><span class="w"> </span><span class="p">:</span>
<span class="w">      </span><span class="n">mcCampaignMD</span><span class="o">=</span><span class="s">&quot;mc20a&quot;</span><span class="p">;</span>
<span class="w">      </span><span class="k">break</span><span class="p">;</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="mi">300000</span><span class="w"> </span><span class="p">:</span>
<span class="w">      </span><span class="n">mcCampaignMD</span><span class="o">=</span><span class="s">&quot;mc20d&quot;</span><span class="p">;</span>
<span class="w">      </span><span class="k">break</span><span class="p">;</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="mi">310000</span><span class="w"> </span><span class="p">:</span>
<span class="w">      </span><span class="n">mcCampaignMD</span><span class="o">=</span><span class="s">&quot;mc20e&quot;</span><span class="p">;</span>
<span class="w">      </span><span class="k">break</span><span class="p">;</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="mi">410000</span><span class="w"> </span><span class="p">:</span>
<span class="w">      </span><span class="n">mcCampaignMD</span><span class="o">=</span><span class="s">&quot;mc23a&quot;</span><span class="p">;</span>
<span class="w">      </span><span class="k">break</span><span class="p">;</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="mi">450000</span><span class="w"> </span><span class="p">:</span>
<span class="w">      </span><span class="n">mcCampaignMD</span><span class="o">=</span><span class="s">&quot;mc23d&quot;</span><span class="p">;</span>
<span class="w">      </span><span class="k">break</span><span class="p">;</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="mi">470000</span><span class="w"> </span><span class="p">:</span>
<span class="w">      </span><span class="n">mcCampaignMD</span><span class="o">=</span><span class="s">&quot;mc23e&quot;</span><span class="p">;</span>
<span class="w">      </span><span class="k">break</span><span class="p">;</span>
<span class="w">    </span><span class="k">default</span><span class="w"> </span><span class="o">:</span>
<span class="w">      </span><span class="n">ANA_MSG_ERROR</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;Could not determine mc campaign from run number! Impossible to autoconfigure PRW. Aborting.&quot;</span><span class="w"> </span><span class="p">);</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="n">StatusCode</span><span class="o">::</span><span class="n">FAILURE</span><span class="p">;</span>
<span class="w">      </span><span class="k">break</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">mcCampaignMD_v2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">;</span>
<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="n">xAOD</span><span class="o">::</span><span class="n">FileMetaData</span><span class="o">*</span><span class="w"> </span><span class="nf">fmd</span><span class="p">(</span><span class="k">nullptr</span><span class="p">);</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="n">m_event</span><span class="o">-&gt;</span><span class="n">retrieveMetaInput</span><span class="p">(</span><span class="n">fmd</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;FileMetaData&quot;</span><span class="p">).</span><span class="n">isSuccess</span><span class="p">()</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">!</span><span class="n">fmd</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">(</span><span class="n">xAOD</span><span class="o">::</span><span class="n">FileMetaData</span><span class="o">::</span><span class="n">mcCampaign</span><span class="p">,</span><span class="w"> </span><span class="n">mcCampaignMD_v2</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">ANA_MSG_WARNING</span><span class="p">(</span><span class="s">&quot;Failed to retrieve FileMetaData from MetaData! Using MC campaign from run number. PLEASE DOUBLE-CHECK this is the correct campaign for your samples!&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">fmd</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">(</span><span class="n">xAOD</span><span class="o">::</span><span class="n">FileMetaData</span><span class="o">::</span><span class="n">mcCampaign</span><span class="p">,</span><span class="w"> </span><span class="n">mcCampaignMD_v2</span><span class="p">);</span>

<span class="w">      </span><span class="k">if</span><span class="p">(</span><span class="n">mcCampaignMD</span><span class="o">!=</span><span class="n">mcCampaignMD_v2</span><span class="p">){</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">MetadataAndRunConflict</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">MetadataAndRunConflict</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s">&quot;autoconfigurePileupRWTool(): access to FileMetaData indicates a &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">mcCampaignMD_v2</span><span class="p">;</span>
<span class="w">        </span><span class="n">MetadataAndRunConflict</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s">&quot; sample, but the run number indiciates &quot;</span><span class="w"> </span><span class="o">+</span><span class="n">mcCampaignMD</span><span class="p">;</span>
<span class="w">        </span><span class="n">MetadataAndRunConflict</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s">&quot;. Prioritizing the value from FileMetaData. This could occur if you are using an MC campaign with outdated pile-up reweighting. PLEASE DOUBLE-CHECK your samples!&quot;</span><span class="p">;</span>
<span class="w">        </span><span class="n">ANA_MSG_WARNING</span><span class="p">(</span><span class="w"> </span><span class="n">MetadataAndRunConflict</span><span class="w"> </span><span class="p">);</span>
<span class="w">        </span><span class="n">mcCampaignMD</span><span class="o">=</span><span class="n">mcCampaignMD_v2</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="n">ANA_MSG_INFO</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;Determined MC campaign to be &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">mcCampaignMD</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// Extract campaign from user configuration</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">tmp_mcCampaign</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_mcCampaign</span><span class="p">;</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">mcCampaignList</span><span class="p">;</span>
<span class="w">  </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">tmp_mcCampaign</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">size_t</span><span class="w"> </span><span class="n">pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tmp_mcCampaign</span><span class="p">.</span><span class="n">find_first_of</span><span class="p">(</span><span class="sc">&#39;,&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">pos</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">::</span><span class="n">npos</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tmp_mcCampaign</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
<span class="w">      </span><span class="n">mcCampaignList</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">tmp_mcCampaign</span><span class="p">.</span><span class="n">substr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">pos</span><span class="p">));</span>
<span class="w">      </span><span class="n">tmp_mcCampaign</span><span class="p">.</span><span class="n">erase</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">pos</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">mcCampaignList</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">tmp_mcCampaign</span><span class="p">.</span><span class="n">substr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">pos</span><span class="p">));</span>
<span class="w">      </span><span class="n">tmp_mcCampaign</span><span class="p">.</span><span class="n">erase</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">pos</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="c1">// Sanity checks</span>
<span class="w">  </span><span class="kt">bool</span><span class="w"> </span><span class="n">mc2XX_GoodFromProperty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">!</span><span class="n">mcCampaignList</span><span class="p">.</span><span class="n">empty</span><span class="p">();</span>
<span class="w">  </span><span class="kt">bool</span><span class="w"> </span><span class="n">mc2XX_GoodFromMetadata</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">  </span><span class="k">for</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">mcCampaignP</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">mcCampaignList</span><span class="p">)</span><span class="w"> </span><span class="n">mc2XX_GoodFromProperty</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">mcCampaignP</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;mc20a&quot;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">mcCampaignP</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;mc20d&quot;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">mcCampaignP</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;mc20e&quot;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">mcCampaignP</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;mc23a&quot;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">mcCampaignP</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;mc23c&quot;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">mcCampaignP</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;mc23d&quot;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">mcCampaignP</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;mc23e&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">mcCampaignMD</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;mc20a&quot;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">mcCampaignMD</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;mc20d&quot;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">mcCampaignMD</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;mc20e&quot;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">mcCampaignMD</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;mc23a&quot;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">mcCampaignMD</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;mc23c&quot;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">mcCampaignMD</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;mc23d&quot;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">mcCampaignMD</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;mc23e&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">mc2XX_GoodFromMetadata</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>

<span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="n">mc2XX_GoodFromMetadata</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">mc2XX_GoodFromProperty</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// ::</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">MetadataAndPropertyBAD</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">MetadataAndPropertyBAD</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s">&quot;autoconfigurePileupRWTool(): access to FileMetaData failed, but don&#39;t panic. You can try to manually set the &#39;mcCampaign&#39; BasicEventSelection property to &quot;</span><span class="p">;</span>
<span class="w">    </span><span class="n">MetadataAndPropertyBAD</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s">&quot;&#39;mc20a&#39;, &#39;mc20c&#39;, &#39;mc20d&#39;, &#39;mc20e&#39;, &#39;mc20f&#39;, &#39;mc23a&#39;, &#39;mc23c&#39;, &#39;mc23d&#39;, or &#39;mc23e&#39; and restart your job. If you set it to any other string, you will still incur in this error.&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="n">ANA_MSG_ERROR</span><span class="p">(</span><span class="w"> </span><span class="n">MetadataAndPropertyBAD</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">StatusCode</span><span class="o">::</span><span class="n">FAILURE</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// ::</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">mc2XX_GoodFromProperty</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">mc2XX_GoodFromMetadata</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">MDinP</span><span class="o">=</span><span class="nb">false</span><span class="p">;</span>
<span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">mcCampaignP</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">mcCampaignList</span><span class="p">)</span><span class="w"> </span><span class="n">MDinP</span><span class="w"> </span><span class="o">|=</span><span class="w"> </span><span class="p">(</span><span class="n">mcCampaignMD</span><span class="o">==</span><span class="n">mcCampaignP</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="n">MDinP</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="c1">// ::</span>
<span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">MetadataAndPropertyConflict</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">);</span>
<span class="w">      </span><span class="n">MetadataAndPropertyConflict</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s">&quot;autoconfigurePileupRWTool(): access to FileMetaData indicates a &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">mcCampaignMD</span><span class="p">;</span>
<span class="w">      </span><span class="n">MetadataAndPropertyConflict</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s">&quot; sample, but the &#39;mcCampaign&#39; property passed to BasicEventSelection is set to &#39;&quot;</span><span class="w"> </span><span class="o">+</span><span class="n">m_mcCampaign</span><span class="p">;</span>
<span class="w">      </span><span class="n">MetadataAndPropertyConflict</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s">&quot;&#39;. Prioritizing the value set by user: PLEASE DOUBLE-CHECK the value you set the &#39;mcCampaign&#39; property to!&quot;</span><span class="p">;</span>
<span class="w">      </span><span class="n">ANA_MSG_WARNING</span><span class="p">(</span><span class="w"> </span><span class="n">MetadataAndPropertyConflict</span><span class="w"> </span><span class="p">);</span>
<span class="w">      </span><span class="c1">// ::</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="c1">// ::</span>
<span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">NoMetadataButPropertyOK</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">);</span>
<span class="w">      </span><span class="n">NoMetadataButPropertyOK</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s">&quot;autoconfigurePileupRWTool(): access to FileMetaData succeeded, but the &#39;mcCampaign&#39; property is passed to BasicEventSelection as &#39;&quot;</span><span class="p">;</span>
<span class="w">      </span><span class="n">NoMetadataButPropertyOK</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">m_mcCampaign</span><span class="p">;</span>
<span class="w">      </span><span class="n">NoMetadataButPropertyOK</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s">&quot;&#39;. Autoconfiguring PRW accordingly.&quot;</span><span class="p">;</span>
<span class="w">      </span><span class="n">ANA_MSG_WARNING</span><span class="p">(</span><span class="w"> </span><span class="n">NoMetadataButPropertyOK</span><span class="w"> </span><span class="p">);</span>
<span class="w">      </span><span class="c1">// ::</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="c1">// ::</span>
<span class="w">  </span><span class="c1">// Retrieve the input file</span>
<span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">mc2XX_GoodFromProperty</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">mcCampaignList</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
<span class="w">    </span><span class="n">mcCampaignList</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">mcCampaignMD</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="n">ANA_MSG_INFO</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;Setting MC campgains for CP::PileupReweightingTool:&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="k">for</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">mcCampaign</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">mcCampaignList</span><span class="p">)</span>
<span class="w">    </span><span class="n">ANA_MSG_INFO</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">mcCampaign</span><span class="p">.</span><span class="n">c_str</span><span class="p">()</span><span class="w"> </span><span class="p">);</span>

<span class="w">  </span><span class="c1">//</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">dsid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-999</span><span class="p">;</span>
<span class="w">  </span><span class="n">dsid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">eventInfo</span><span class="o">-&gt;</span><span class="n">mcChannelNumber</span><span class="p">();</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">DSID_INT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="n">dsid</span><span class="p">;</span>

<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">prwConfigFiles</span><span class="p">;</span>
<span class="w">  </span><span class="k">for</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">mcCampaign</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">mcCampaignList</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">prwConfigFile</span><span class="p">;</span>
<span class="w">      </span><span class="c1">// If requested set the PRW file to common PRW file of the processed MC campaign</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">m_useCommonPRWFiles</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w">      </span><span class="p">(</span><span class="n">mcCampaign</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;mc20a&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="n">prwConfigFile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PathResolverFindCalibFile</span><span class="p">(</span><span class="n">m_commonPRWFileMC20a</span><span class="p">);}</span>
<span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">mcCampaign</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;mc20d&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="n">prwConfigFile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PathResolverFindCalibFile</span><span class="p">(</span><span class="n">m_commonPRWFileMC20d</span><span class="p">);}</span>
<span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">mcCampaign</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;mc20e&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="n">prwConfigFile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PathResolverFindCalibFile</span><span class="p">(</span><span class="n">m_commonPRWFileMC20e</span><span class="p">);}</span>
<span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">mcCampaign</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;mc23a&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="n">prwConfigFile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PathResolverFindCalibFile</span><span class="p">(</span><span class="n">m_commonPRWFileMC23a</span><span class="p">);}</span>
<span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">mcCampaign</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;mc23c&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="n">prwConfigFile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PathResolverFindCalibFile</span><span class="p">(</span><span class="n">m_commonPRWFileMC23c</span><span class="p">);}</span>
<span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">mcCampaign</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;mc23d&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="n">prwConfigFile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PathResolverFindCalibFile</span><span class="p">(</span><span class="n">m_commonPRWFileMC23d</span><span class="p">);}</span>
<span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">mcCampaign</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;mc23e&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="n">prwConfigFile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PathResolverFindCalibFile</span><span class="p">(</span><span class="n">m_commonPRWFileMC23e</span><span class="p">);}</span>
<span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="n">ANA_MSG_ERROR</span><span class="p">(</span><span class="s">&quot;autoconfigurePileupRWTool(): no common PRW file known for MC campaign: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">mcCampaign</span><span class="p">);</span>
<span class="w">          </span><span class="k">return</span><span class="w"> </span><span class="n">StatusCode</span><span class="o">::</span><span class="n">FAILURE</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">prwConfigFile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PathResolverFindCalibFile</span><span class="p">(</span><span class="s">&quot;dev/PileupReweighting/share/DSID&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="n">DSID_INT</span><span class="o">/</span><span class="mi">1000</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="s">&quot;xxx/pileup_&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">mcCampaign</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;_dsid&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="n">DSID_INT</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;_&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">SimulationFlavour</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;.root&quot;</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="n">TFile</span><span class="w"> </span><span class="n">testF</span><span class="p">(</span><span class="n">prwConfigFile</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span><span class="s">&quot;read&quot;</span><span class="p">);</span>
<span class="w">      </span><span class="k">if</span><span class="p">(</span><span class="n">testF</span><span class="p">.</span><span class="n">IsZombie</span><span class="p">())</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="n">ANA_MSG_ERROR</span><span class="p">(</span><span class="s">&quot;autoconfigurePileupRWTool(): Missing PRW config file for DSID &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="n">DSID_INT</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; in campaign &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">mcCampaign</span><span class="p">);</span>
<span class="w">          </span><span class="k">return</span><span class="w"> </span><span class="n">StatusCode</span><span class="o">::</span><span class="n">FAILURE</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="k">else</span>
<span class="w">        </span><span class="n">prwConfigFiles</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="w"> </span><span class="n">prwConfigFile</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">  </span><span class="c1">// Add actualMu config files</span>
<span class="w">  </span><span class="k">for</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">mcCampaign</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">mcCampaignList</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="n">m_prwActualMu2016File</span><span class="p">.</span><span class="n">empty</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">mcCampaign</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;mc20a&quot;</span><span class="w"> </span><span class="p">)</span>
<span class="w">        </span><span class="n">prwConfigFiles</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">PathResolverFindCalibFile</span><span class="p">(</span><span class="n">m_prwActualMu2016File</span><span class="p">));</span>
<span class="w">      </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="n">m_prwActualMu2017File</span><span class="p">.</span><span class="n">empty</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">mcCampaign</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;mc20c&quot;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">mcCampaign</span><span class="o">==</span><span class="s">&quot;mc20d&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">)</span>
<span class="w">        </span><span class="n">prwConfigFiles</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">PathResolverFindCalibFile</span><span class="p">(</span><span class="n">m_prwActualMu2017File</span><span class="p">));</span>
<span class="w">      </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="n">m_prwActualMu2018File</span><span class="p">.</span><span class="n">empty</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">mcCampaign</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;mc20e&quot;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">mcCampaign</span><span class="o">==</span><span class="s">&quot;mc20f&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">)</span>
<span class="w">        </span><span class="n">prwConfigFiles</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">PathResolverFindCalibFile</span><span class="p">(</span><span class="n">m_prwActualMu2018File</span><span class="p">));</span>
<span class="w">      </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="n">m_prwActualMu2022File</span><span class="p">.</span><span class="n">empty</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">mcCampaign</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;mc23a&quot;</span><span class="w"> </span><span class="p">)</span>
<span class="w">        </span><span class="n">prwConfigFiles</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">PathResolverFindCalibFile</span><span class="p">(</span><span class="n">m_prwActualMu2022File</span><span class="p">));</span>
<span class="w">      </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="n">m_prwActualMu2023File</span><span class="p">.</span><span class="n">empty</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">mcCampaign</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;mc23c&quot;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">mcCampaign</span><span class="o">==</span><span class="s">&quot;mc23d&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">)</span>
<span class="w">        </span><span class="n">prwConfigFiles</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">PathResolverFindCalibFile</span><span class="p">(</span><span class="n">m_prwActualMu2023File</span><span class="p">));</span>
<span class="w">      </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="n">m_prwActualMu2024File</span><span class="p">.</span><span class="n">empty</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">mcCampaign</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;mc23e&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">)</span>
<span class="w">        </span><span class="n">prwConfigFiles</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">PathResolverFindCalibFile</span><span class="p">(</span><span class="n">m_prwActualMu2024File</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">  </span><span class="c1">// also need to handle lumicalc files: only use 2015+2016 with mc20a</span>
<span class="w">  </span><span class="c1">// and only use 2017 with mc20d and 2018 data with mc20e</span>
<span class="w">  </span><span class="c1">// according to instructions on https://twiki.cern.ch/twiki/bin/view/AtlasProtected/ExtendedPileupReweighting#Tool_Properties</span>

<span class="w">  </span><span class="c1">// Parse lumicalc file names</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">allLumiCalcFiles</span><span class="p">;</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">tmp_lumiCalcFileNames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_lumiCalcFileNames</span><span class="p">;</span>
<span class="w">  </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">tmp_lumiCalcFileNames</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">size_t</span><span class="w"> </span><span class="n">pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tmp_lumiCalcFileNames</span><span class="p">.</span><span class="n">find_first_of</span><span class="p">(</span><span class="sc">&#39;,&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">pos</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">::</span><span class="n">npos</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tmp_lumiCalcFileNames</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
<span class="w">      </span><span class="n">allLumiCalcFiles</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">tmp_lumiCalcFileNames</span><span class="p">.</span><span class="n">substr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">pos</span><span class="p">));</span>
<span class="w">      </span><span class="n">tmp_lumiCalcFileNames</span><span class="p">.</span><span class="n">erase</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">pos</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">allLumiCalcFiles</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">tmp_lumiCalcFileNames</span><span class="p">.</span><span class="n">substr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">pos</span><span class="p">));</span>
<span class="w">      </span><span class="n">tmp_lumiCalcFileNames</span><span class="p">.</span><span class="n">erase</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">pos</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">lumiCalcFiles</span><span class="p">;</span>
<span class="w">  </span><span class="k">for</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">mcCampaign</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">mcCampaignList</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="k">for</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">filename</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">allLumiCalcFiles</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="c1">// looking for things of format &quot;stuff/data15_13TeV/stuff&quot; etc</span>
<span class="w">      </span><span class="kt">size_t</span><span class="w"> </span><span class="n">pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">filename</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="s">&quot;data&quot;</span><span class="p">);</span>
<span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">year</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">filename</span><span class="p">.</span><span class="n">substr</span><span class="p">(</span><span class="n">pos</span><span class="o">+</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>

<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">mcCampaign</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;mc20a&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">year</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;15&quot;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">year</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;16&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="n">lumiCalcFiles</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">filename</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">mcCampaign</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;mc20d&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">year</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;17&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="n">lumiCalcFiles</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">filename</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">mcCampaign</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;mc20e&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">year</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;18&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="n">lumiCalcFiles</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">filename</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">mcCampaign</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;mc23a&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">year</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;22&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="n">lumiCalcFiles</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">filename</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">mcCampaign</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;mc23c&quot;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">mcCampaign</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;mc23d&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">year</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;23&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="n">lumiCalcFiles</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">filename</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">mcCampaign</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;mc23e&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">year</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;24&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="n">lumiCalcFiles</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">filename</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">ANA_MSG_ERROR</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;No lumicalc file is suitable for your mc campaign!&quot;</span><span class="w"> </span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">  </span><span class="c1">// Set everything and report on it.</span>
<span class="w">  </span><span class="n">ANA_MSG_INFO</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;Adding Pileup files for CP::PileupReweightingTool:&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="k">for</span><span class="p">(</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">prwConfigFiles</span><span class="p">.</span><span class="n">size</span><span class="p">();</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">ANA_MSG_INFO</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">- &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">prwConfigFiles</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">c_str</span><span class="p">());</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="n">ANA_CHECK</span><span class="p">(</span><span class="w"> </span><span class="n">m_pileup_tool_handle</span><span class="p">.</span><span class="n">setProperty</span><span class="p">(</span><span class="s">&quot;ConfigFiles&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">prwConfigFiles</span><span class="p">));</span>

<span class="w">  </span><span class="n">ANA_MSG_INFO</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;Adding LumiCalc files for CP::PileupReweightingTool:&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="k">for</span><span class="p">(</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">lumiCalcFiles</span><span class="p">.</span><span class="n">size</span><span class="p">();</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">ANA_MSG_INFO</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">- &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">lumiCalcFiles</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">c_str</span><span class="p">());</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="n">ANA_CHECK</span><span class="p">(</span><span class="w"> </span><span class="n">m_pileup_tool_handle</span><span class="p">.</span><span class="n">setProperty</span><span class="p">(</span><span class="s">&quot;LumiCalcFiles&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">lumiCalcFiles</span><span class="p">));</span>

<span class="w">  </span><span class="c1">// Return gracefully</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">StatusCode</span><span class="o">::</span><span class="n">SUCCESS</span><span class="p">;</span>
<span class="p">}</span>


<span class="n">EL</span><span class="o">::</span><span class="n">StatusCode</span><span class="w"> </span><span class="n">BasicEventSelection</span><span class="w"> </span><span class="o">::</span><span class="w"> </span><span class="n">postExecute</span><span class="w"> </span><span class="p">()</span>
<span class="p">{</span>
<span class="w">  </span><span class="c1">// Here you do everything that needs to be done after the main event</span>
<span class="w">  </span><span class="c1">// processing.  This is typically very rare, particularly in user</span>
<span class="w">  </span><span class="c1">// code.  It is mainly used in implementing the NTupleSvc.</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">EL</span><span class="o">::</span><span class="n">StatusCode</span><span class="o">::</span><span class="n">SUCCESS</span><span class="p">;</span>
<span class="p">}</span>



<span class="n">EL</span><span class="o">::</span><span class="n">StatusCode</span><span class="w"> </span><span class="n">BasicEventSelection</span><span class="w"> </span><span class="o">::</span><span class="w"> </span><span class="n">finalize</span><span class="w"> </span><span class="p">()</span>
<span class="p">{</span>
<span class="w">  </span><span class="c1">// This method is the mirror image of initialize(), meaning it gets</span>
<span class="w">  </span><span class="c1">// called after the last event has been processed on the worker node</span>
<span class="w">  </span><span class="c1">// and allows you to finish up any objects you created in</span>
<span class="w">  </span><span class="c1">// initialize() before they are written to disk.  This is actually</span>
<span class="w">  </span><span class="c1">// fairly rare, since this happens separately for each worker node.</span>
<span class="w">  </span><span class="c1">// Most of the time you want to do your post-processing on the</span>
<span class="w">  </span><span class="c1">// submission node after all your histogram outputs have been</span>
<span class="w">  </span><span class="c1">// merged.  This is different from histFinalize() in that it only</span>
<span class="w">  </span><span class="c1">// gets called on worker nodes that processed input events.</span>

<span class="w">  </span><span class="n">ANA_MSG_INFO</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;Number of processed events </span><span class="se">\t</span><span class="s">= &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">m_eventCounter</span><span class="p">);</span>

<span class="w">  </span><span class="n">m_RunNr_VS_EvtNr</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">m_trigDecTool_handle</span><span class="p">.</span><span class="n">isInitialized</span><span class="p">()</span><span class="w"> </span><span class="p">){</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">asg</span><span class="o">::</span><span class="n">ToolStore</span><span class="o">::</span><span class="n">contains</span><span class="o">&lt;</span><span class="n">Trig</span><span class="o">::</span><span class="n">TrigDecisionTool</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;ToolSvc.TrigDecisionTool&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">){</span>
<span class="w">      </span><span class="n">m_trigDecTool_handle</span><span class="o">-&gt;</span><span class="n">finalize</span><span class="p">();</span>
<span class="w">      </span><span class="n">asg</span><span class="o">::</span><span class="n">ToolStore</span><span class="o">::</span><span class="n">remove</span><span class="p">(</span><span class="s">&quot;ToolSvc.TrigDecisionTool&quot;</span><span class="p">).</span><span class="n">ignore</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="c1">//after execution loop</span>
<span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="n">m_printBranchList</span><span class="p">){</span>
<span class="w">    </span><span class="n">xAOD</span><span class="o">::</span><span class="n">IOStats</span><span class="o">::</span><span class="n">instance</span><span class="p">().</span><span class="n">stats</span><span class="p">().</span><span class="n">printSmartSlimmingBranchList</span><span class="p">();</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">EL</span><span class="o">::</span><span class="n">StatusCode</span><span class="o">::</span><span class="n">SUCCESS</span><span class="p">;</span>
<span class="p">}</span>



<span class="n">EL</span><span class="o">::</span><span class="n">StatusCode</span><span class="w"> </span><span class="n">BasicEventSelection</span><span class="w"> </span><span class="o">::</span><span class="w"> </span><span class="n">histFinalize</span><span class="w"> </span><span class="p">()</span>
<span class="p">{</span>
<span class="w">  </span><span class="c1">// This method is the mirror image of histInitialize(), meaning it</span>
<span class="w">  </span><span class="c1">// gets called after the last event has been processed on the worker</span>
<span class="w">  </span><span class="c1">// node and allows you to finish up any objects you created in</span>
<span class="w">  </span><span class="c1">// histInitialize() before they are written to disk.  This is</span>
<span class="w">  </span><span class="c1">// actually fairly rare, since this happens separately for each</span>
<span class="w">  </span><span class="c1">// worker node.  Most of the time you want to do your</span>
<span class="w">  </span><span class="c1">// post-processing on the submission node after all your histogram</span>
<span class="w">  </span><span class="c1">// outputs have been merged.  This is different from finalize() in</span>
<span class="w">  </span><span class="c1">// that it gets called on all worker nodes regardless of whether</span>
<span class="w">  </span><span class="c1">// they processed input events.</span>
<span class="w">  </span><span class="n">ANA_CHECK</span><span class="p">(</span><span class="w"> </span><span class="n">xAH</span><span class="o">::</span><span class="n">Algorithm</span><span class="o">::</span><span class="n">algFinalize</span><span class="p">());</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">EL</span><span class="o">::</span><span class="n">StatusCode</span><span class="o">::</span><span class="n">SUCCESS</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015-2017, ATLAS Collaboration

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>