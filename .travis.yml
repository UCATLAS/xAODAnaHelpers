# our main test script
services: docker
language: ruby
# only test 'push' builds to master (including PRs that target master)
branches:
  only:
    - master

# below are specific matrix includes for building documentation
#    and running cppcheck (not actually used)
matrix:
  fast_finish: true
  include:
    - language: python
      python: 2.7
      sudo: false
      env: JOB="Building online documentation"
      addons:
        apt:
          packages:
            - doxygen
            - doxygen-doc
            - doxygen-gui
            - doxygen-latex
            - graphviz
      install: pip install -r docs/requirements.txt
      script:
        - cd docs
        - doxygen
        - make html
        - cd ..
        - touch docs/_build/html/.nojekyll
      deploy:
        provider: pages
        skip_cleanup: true
        github_token: $GITHUB_TOKEN
        local_dir: docs/_build/html
        on:
          branch: master

    - language: cpp
      sudo: required
      services:
        - docker
      env: JOB="uncrustify check"
      before_script:
        - docker pull unibeautify/uncrustify
      script:
        - docker run -it -v "$(pwd)":/workdir -w /workdir unibeautify/uncrustify -c ci/uncrustify.cfg --check **/**.cxx || exit 0

notifications:
  email:
    on_success: never
    on_failure: always
